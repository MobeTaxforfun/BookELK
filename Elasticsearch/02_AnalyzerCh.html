<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Elasticsearch 中文分詞 | 我的 Elastic Stack 筆記</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="已經到了不記下來就會忘記的年紀了，紀錄一下自身學習 Elasticsearch;Logstash;Kibana;Beats 的一些歷程">
    
    <link rel="preload" href="/BookELK/assets/css/0.styles.d96730b3.css" as="style"><link rel="preload" href="/BookELK/assets/js/app.d1103cb6.js" as="script"><link rel="preload" href="/BookELK/assets/js/2.c1f4f9ff.js" as="script"><link rel="preload" href="/BookELK/assets/js/3.24ed4b19.js" as="script"><link rel="prefetch" href="/BookELK/assets/js/10.05547e24.js"><link rel="prefetch" href="/BookELK/assets/js/11.1893c882.js"><link rel="prefetch" href="/BookELK/assets/js/12.d4608ef8.js"><link rel="prefetch" href="/BookELK/assets/js/13.4fc9ebc0.js"><link rel="prefetch" href="/BookELK/assets/js/14.379ec2a8.js"><link rel="prefetch" href="/BookELK/assets/js/15.8151bdeb.js"><link rel="prefetch" href="/BookELK/assets/js/16.f4b2dcb9.js"><link rel="prefetch" href="/BookELK/assets/js/17.0add865d.js"><link rel="prefetch" href="/BookELK/assets/js/18.4ed79c70.js"><link rel="prefetch" href="/BookELK/assets/js/19.95351235.js"><link rel="prefetch" href="/BookELK/assets/js/20.a1022e1f.js"><link rel="prefetch" href="/BookELK/assets/js/21.b6c00c5a.js"><link rel="prefetch" href="/BookELK/assets/js/22.dfa5a0e8.js"><link rel="prefetch" href="/BookELK/assets/js/23.ef28a39c.js"><link rel="prefetch" href="/BookELK/assets/js/24.c7c22e87.js"><link rel="prefetch" href="/BookELK/assets/js/25.806f97ba.js"><link rel="prefetch" href="/BookELK/assets/js/26.af37477b.js"><link rel="prefetch" href="/BookELK/assets/js/27.b7722ef1.js"><link rel="prefetch" href="/BookELK/assets/js/28.d40d4d3e.js"><link rel="prefetch" href="/BookELK/assets/js/29.ece48b4d.js"><link rel="prefetch" href="/BookELK/assets/js/4.5eff1dea.js"><link rel="prefetch" href="/BookELK/assets/js/5.ec56dde3.js"><link rel="prefetch" href="/BookELK/assets/js/6.6ad41d71.js"><link rel="prefetch" href="/BookELK/assets/js/7.6a2dd547.js"><link rel="prefetch" href="/BookELK/assets/js/8.52a784b1.js"><link rel="prefetch" href="/BookELK/assets/js/9.d2551150.js">
    <link rel="stylesheet" href="/BookELK/assets/css/0.styles.d96730b3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BookELK/" class="home-link router-link-active"><!----> <span class="site-name">我的 Elastic Stack 筆記</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Elasticsearch</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BookELK/Elasticsearch/01_Introduction.html" class="sidebar-link">基本</a></li><li><a href="/BookELK/Elasticsearch/01_Template.html" class="sidebar-link">測試資料</a></li><li><a href="/BookELK/Elasticsearch/02_Index.html" class="sidebar-link">Index</a></li><li><a href="/BookELK/Elasticsearch/02_Document.html" class="sidebar-link">Document</a></li><li><a href="/BookELK/Elasticsearch/02_Mapping.html" class="sidebar-link">Mapping</a></li><li><a href="/BookELK/Elasticsearch/02_Aliases.html" class="sidebar-link">Index Aliases</a></li><li><a href="/BookELK/Elasticsearch/02_Analyzer.html" class="sidebar-link">Analyzer</a></li><li><a href="/BookELK/Elasticsearch/02_AnalyzerCh.html" aria-current="page" class="active sidebar-link">Analyzer 中文分詞</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/02_AnalyzerCh.html#安裝-analysis-ik" class="sidebar-link">安裝 analysis-ik</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/02_AnalyzerCh.html#測試-ik-分詞" class="sidebar-link">測試 IK 分詞</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/02_AnalyzerCh.html#安裝-analysis-ik-繁中" class="sidebar-link">安裝  analysis-ik 繁中</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/02_AnalyzerCh.html#測試-ik繁體-分詞" class="sidebar-link">測試 IK繁體 分詞</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/02_AnalyzerCh.html#使用中文分詞" class="sidebar-link">使用中文分詞</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/02_AnalyzerCh.html#更新字典" class="sidebar-link">更新字典</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/02_AnalyzerCh.html#抓取遠端字典" class="sidebar-link">抓取遠端字典</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/02_AnalyzerCh.html#結巴分詞" class="sidebar-link">結巴分詞</a></li></ul></li><li><a href="/BookELK/Elasticsearch/02_SearchAPI.html" class="sidebar-link">Search API</a></li><li><a href="/BookELK/Elasticsearch/02_Query.html" class="sidebar-link">Query DSL</a></li><li><a href="/BookELK/Elasticsearch/02_Aggregations.html" class="sidebar-link">Aggregations</a></li><li><a href="/BookELK/Elasticsearch/03_Cat.html" class="sidebar-link">cat</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>kibana</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Logstash</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Beats</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Demo</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Elastic stack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="elasticsearch-中文分詞"><a href="#elasticsearch-中文分詞" class="header-anchor">#</a> Elasticsearch 中文分詞</h1> <p>在 Elasticsearch 中，中文分詞是一個非常特殊的存在，中文幾乎是不可能靠著原生的分析器做到合理的斷詞，所以我們必須借助一些其他的 Plugin 來幫助我們處理中文斷詞的問題，以下紀錄一下安裝以及使用 IK Analysis 的過程</p> <p>📘 Reference</p> <ul><li><a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="noopener noreferrer">ik 分詞器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/sunghau/elasticsearch-analysis-ik-config-traditional-chinese" target="_blank" rel="noopener noreferrer">ik 繁體<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 網路上能搜到的大多是以這個為繁體字庫，但有點舊了上次更新是 2015...</li> <li>有 survey 到用中研院的分詞 CKIP Lab，不過沒有支持 Elasticsearch 擴充，要自己打API去分詞再把分詞結果寫進 ES 裡面，然後一邊建立字庫</li> <li><a href="https://github.com/sing1ee/elasticsearch-jieba-plugin" target="_blank" rel="noopener noreferrer">結巴分詞<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="安裝-analysis-ik"><a href="#安裝-analysis-ik" class="header-anchor">#</a> 安裝 analysis-ik</h2> <ul><li><p>到上方的連結下載相對應 Release 版本，這邊使用 elasticsearch-analysis-ik-7.17.1</p></li> <li><p>接著在安裝 Elasticsearch 的目錄下找到 plugins</p> <div class="language-sh extra-class"><pre class="language-sh"><code>root@646ef2f0ce45:/usr/share/elasticsearch<span class="token comment"># ls</span>
LICENSE.txt  NOTICE.txt  README.asciidoc  bin  config  data  jdk  lib  logs  modules  plugins
root@646ef2f0ce45:/usr/share/elasticsearch<span class="token comment"># cd plugins/</span>
root@646ef2f0ce45:/usr/share/elasticsearch/plugins<span class="token comment"># pwd</span>
/usr/share/elasticsearch/plugins
</code></pre></div></li> <li><p>將下載的 elasticsearch-analysis-ik-7.17.1 解壓縮後加到 plugins 這個資料夾下</p></li> <li><p>這邊我的 Elasticsearch 使用 Docker 搭建，再啟動 Container 的時候已經將 plugins 掛載到本機下面了<br> <img src="/BookELK/assets/img/dockerpluginsvolumes.d4336afc.png" alt="Plugin掛載"></p></li> <li><p>找到掛載的路徑直接貼上<br> <img src="data:image/png;base64,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" alt="Plugin掛載本機"></p></li> <li><p>進到容器中察看，如果有成功對應會出現 <code>elasticsearch-analysis-ik</code> 這個資料夾</p> <div class="language-sh extra-class"><pre class="language-sh"><code>root@646ef2f0ce45:/usr/share/elasticsearch/plugins<span class="token comment"># ls </span>
elasticsearch-analysis-ik
</code></pre></div></li> <li><p>接著到 <code>/usr/share/elasticsearch/bin</code> 這個路徑底下，執行 <code>elasticsearch-plugin list</code>，列出所有 plugins 會看到 elasticsearch-analysis-ik</p> <div class="language-sh extra-class"><pre class="language-sh"><code>root@646ef2f0ce45:/usr/share/elasticsearch/bin<span class="token comment"># elasticsearch-plugin list</span>
elasticsearch-analysis-ik
</code></pre></div></li> <li><p>重啟容器 或 Elasticsearch 確保 Plugins 已經註冊</p></li></ul> <h2 id="測試-ik-分詞"><a href="#測試-ik-分詞" class="header-anchor">#</a> 測試 IK 分詞</h2> <p>比較一下 Ik 分詞 <code>analysis-ik</code> 跟 內置分詞 <code>standard</code> 的區別</p> <ul><li><p>使用 <code>standard</code> 分析器</p> <div class="language-sh extra-class"><pre class="language-sh"><code>GET /_analyze/
<span class="token punctuation">{</span>
  <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;standard&quot;</span>,
  <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;憧憬是距離理解最遙遠的感情&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/BookELK/assets/img/standardanalyzerresult.decb69c9.png" alt="預設分詞結果"></p> <p>輸出:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">[</span> <span class="token string">&quot;憧&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;憬&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;是&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;距&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;離&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;理&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;解&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;最&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遙&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遠&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;的&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;感&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;情&quot;</span> <span class="token punctuation">]</span>
</code></pre></div><p>基本上用預設的分析器來對中文做分詞，不管以什麼角度來說都不太對勁</p></li> <li><p>使用 <code>analysis-ik</code> IK分詞</p> <div class="language-JSON extra-class"><pre class="language-json"><code>GET /_analyze/
<span class="token punctuation">{</span>
  <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;憧憬是距離理解最遙遠的感情&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/BookELK/assets/img/ikanalyzerresult.7766464e.png" alt="ik分詞結果"></p> <p>輸出:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">[</span> <span class="token string">&quot;憧憬&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;是&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;距&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;離&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;理解&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;最&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遙&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遠&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;的&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;感情&quot;</span> <span class="token punctuation">]</span>
</code></pre></div><p>結果看起來是有按照一的中文詞彙分詞了，但還是感覺哪裡不太對勁，其原因是 ik 分詞本身的字庫是簡體中文，若我們要用繁體中文需要更新一下字庫</p></li></ul> <h2 id="安裝-analysis-ik-繁中"><a href="#安裝-analysis-ik-繁中" class="header-anchor">#</a> 安裝  analysis-ik 繁中</h2> <ul><li><p>一樣到上方的 [ik繁體] 連結中把整個 Repository 拉下來</p></li> <li><p>拉下來打開資料夾長這樣，這邊關注紅色框的兩個檔案<br> <img src="/BookELK/assets/img/ikanalyzerzhtw.ba49aa1b.png" alt="ik繁體安裝"></p></li> <li><p><code>IKAnalyzer.cfg.xml</code> 為 <code>IK Analyzer 扩展配置</code>，在設定中會把字典指向 custom 資料夾擴展的繁體分詞字典就放在 <code>custom</code> 裡面</p></li> <li><p>設置 IK 繁體擴展，在這個路徑下面 <code>/usr/share/elasticsearch/plugins/elasticsearch-analysis-ik/config</code>，會看到 <code>IKAnalyzer.cfg.xml</code> 這個 XML 檔，我們要做的就是把剛剛下載的檔案複製過來</p> <p><img src="/BookELK/assets/img/ikconfigpath.2902a27a.png" alt="IK繁體擴展路徑"></p></li> <li><p>加入擴展檔案，plugins裡面的IK分詞會如下圖</p> <p><img src="/BookELK/assets/img/ikconfighostpath.b20e8d2d.png" alt="IK繁體擴展實體路徑"></p></li></ul> <h2 id="測試-ik繁體-分詞"><a href="#測試-ik繁體-分詞" class="header-anchor">#</a> 測試 IK繁體 分詞</h2> <ul><li><p>使用 IK繁體 分詞</p> <div class="language-JSON extra-class"><pre class="language-json"><code>GET /_analyze/
<span class="token punctuation">{</span>
  <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;憧憬是距離理解最遙遠的感情&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/BookELK/assets/img/ikanalyzertwzhresult.05d5e188.png" alt="ik分詞結果"></p> <p>輸出:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">[</span> <span class="token string">&quot;憧憬&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;憧&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;憬&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;距離&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;距&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;離&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;理解&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;理&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;最&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遙遠&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遙&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遠&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;感情&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;感&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;情&quot;</span> <span class="token punctuation">]</span>
</code></pre></div><p>這個就可以看到分析器準確地命中，<code>憧憬</code>;<code>距離</code>;<code>理解</code>;<code>遙遠</code>;<code>感情</code>，這幾個單詞，代表剛剛設定的繁體中文字典已經被加進分析器中</p></li></ul> <h2 id="使用中文分詞"><a href="#使用中文分詞" class="header-anchor">#</a> 使用中文分詞</h2> <p>在 IK Analysis 的文件裡面明確指出 IK Analysis 裡面有兩種 <code>Analyzer</code></p> <blockquote><p>Analyzer: ik_smart , ik_max_word , Tokenizer: ik_smart , ik_max_word
兩個的差異是 ik_smart 僅解析出字詞，ik_max_word 會將所有的分詞結果盡可能地列舉出來，如下</p></blockquote> <ul><li><p>ik_smart</p> <p>這是使用 ik_smart 的效果</p> <div class="language-JSON extra-class"><pre class="language-json"><code>GET /_analyze/
<span class="token punctuation">{</span>
  <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_smart&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;憧憬是距離理解最遙遠的感情&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/BookELK/assets/img/ik_smartanalyzerresult.fcc530f1.png" alt="ik_smart結果"></p> <p>輸出:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">[</span> <span class="token string">&quot;憧憬&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;距離&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;理解&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;最&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遙遠&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;感情&quot;</span><span class="token punctuation">]</span>
</code></pre></div></li> <li><p>ik_max_word</p> <p>這是使用 ik_max_word 的效果(跟上面測試時的效果一樣)</p> <div class="language-JSON extra-class"><pre class="language-json"><code>GET /_analyze/
<span class="token punctuation">{</span>
  <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;憧憬是距離理解最遙遠的感情&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>輸出:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">[</span> <span class="token string">&quot;憧憬&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;憧&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;憬&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;距離&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;距&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;離&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;理解&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;理&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;最&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遙遠&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遙&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;遠&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;感情&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;感&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;情&quot;</span> <span class="token punctuation">]</span>
</code></pre></div></li> <li><p>Mapping Ik 分詞</p> <p>使用 _mapping 便可以指定 field 使用 IK Analysis</p> <div class="language-JSON extra-class"><pre class="language-json"><code>PUT /ikanalyzertest/_mapping
<span class="token punctuation">{</span>
  <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_max_word&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="更新字典"><a href="#更新字典" class="header-anchor">#</a> 更新字典</h2> <h2 id="抓取遠端字典"><a href="#抓取遠端字典" class="header-anchor">#</a> 抓取遠端字典</h2> <p>有用到會來更新</p> <h2 id="結巴分詞"><a href="#結巴分詞" class="header-anchor">#</a> 結巴分詞</h2> <p>待續</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/BookELK/Elasticsearch/02_Analyzer.html" class="prev">
        Analyzer
      </a></span> <span class="next"><a href="/BookELK/Elasticsearch/02_SearchAPI.html">
        Search API
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/BookELK/assets/js/app.d1103cb6.js" defer></script><script src="/BookELK/assets/js/2.c1f4f9ff.js" defer></script><script src="/BookELK/assets/js/3.24ed4b19.js" defer></script>
  </body>
</html>
