<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ELasticsearch | æˆ‘çš„ Elastic Stack ç­†è¨˜</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="å·²ç¶“åˆ°äº†ä¸è¨˜ä¸‹ä¾†å°±æœƒå¿˜è¨˜çš„å¹´ç´€äº†ï¼Œç´€éŒ„ä¸€ä¸‹è‡ªèº«å­¸ç¿’ Elasticsearch;Logstash;Kibana;Beats çš„ä¸€äº›æ­·ç¨‹">
    
    <link rel="preload" href="/BookELK/assets/css/0.styles.d96730b3.css" as="style"><link rel="preload" href="/BookELK/assets/js/app.76926c1b.js" as="script"><link rel="preload" href="/BookELK/assets/js/2.6319aacc.js" as="script"><link rel="preload" href="/BookELK/assets/js/3.51cc2f96.js" as="script"><link rel="prefetch" href="/BookELK/assets/js/10.a870efe4.js"><link rel="prefetch" href="/BookELK/assets/js/11.1bf0ef2c.js"><link rel="prefetch" href="/BookELK/assets/js/12.26ef642a.js"><link rel="prefetch" href="/BookELK/assets/js/13.32f0189e.js"><link rel="prefetch" href="/BookELK/assets/js/14.e15f0edf.js"><link rel="prefetch" href="/BookELK/assets/js/15.75eba30d.js"><link rel="prefetch" href="/BookELK/assets/js/16.61622831.js"><link rel="prefetch" href="/BookELK/assets/js/17.36ad0752.js"><link rel="prefetch" href="/BookELK/assets/js/18.ef5a7d26.js"><link rel="prefetch" href="/BookELK/assets/js/19.ed2f083d.js"><link rel="prefetch" href="/BookELK/assets/js/20.3023fff0.js"><link rel="prefetch" href="/BookELK/assets/js/21.479d1e86.js"><link rel="prefetch" href="/BookELK/assets/js/22.a6b074b8.js"><link rel="prefetch" href="/BookELK/assets/js/23.85f62943.js"><link rel="prefetch" href="/BookELK/assets/js/24.b152d338.js"><link rel="prefetch" href="/BookELK/assets/js/25.3d08c2ca.js"><link rel="prefetch" href="/BookELK/assets/js/26.482be533.js"><link rel="prefetch" href="/BookELK/assets/js/27.f78275e0.js"><link rel="prefetch" href="/BookELK/assets/js/28.0c971abe.js"><link rel="prefetch" href="/BookELK/assets/js/29.07505f8d.js"><link rel="prefetch" href="/BookELK/assets/js/30.75b6a2e6.js"><link rel="prefetch" href="/BookELK/assets/js/31.d14f8f00.js"><link rel="prefetch" href="/BookELK/assets/js/32.4b2e25c5.js"><link rel="prefetch" href="/BookELK/assets/js/4.509066ce.js"><link rel="prefetch" href="/BookELK/assets/js/5.a7dd103d.js"><link rel="prefetch" href="/BookELK/assets/js/6.67ab2b88.js"><link rel="prefetch" href="/BookELK/assets/js/7.cde76e12.js"><link rel="prefetch" href="/BookELK/assets/js/8.9bb44987.js"><link rel="prefetch" href="/BookELK/assets/js/9.c48b5107.js">
    <link rel="stylesheet" href="/BookELK/assets/css/0.styles.d96730b3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BookELK/" class="home-link router-link-active"><!----> <span class="site-name">æˆ‘çš„ Elastic Stack ç­†è¨˜</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Elasticsearch</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BookELK/Elasticsearch/01_Introduction.html" class="sidebar-link">ELK Stack Intro</a></li><li><a href="/BookELK/Elasticsearch/01_Elasticsearch.html" aria-current="page" class="active sidebar-link">Elasticsearch Intro</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#more-about-elasticsearch" class="sidebar-link">More About ELasticsearch</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#rdbms-vs-elasticsearch" class="sidebar-link">RDBMS vs. Elasticsearch</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#index" class="sidebar-link">Index</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#inverted-index" class="sidebar-link">Inverted Index</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#inverted-index-for-elasticsearch" class="sidebar-link">Inverted Index For Elasticsearch</a></li></ul></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#document" class="sidebar-link">Document</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#mapping" class="sidebar-link">Mapping</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#dynamic-mapping" class="sidebar-link">Dynamic mapping</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#explicit-mapping" class="sidebar-link">Explicit mapping</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#field" class="sidebar-link">Field</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#metadata-fields" class="sidebar-link">Metadata fields</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#field-data-types" class="sidebar-link">Field data types</a></li></ul></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#search" class="sidebar-link">Search</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#analyzer" class="sidebar-link">Analyzer</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#distributed-document-store" class="sidebar-link">Distributed Document Store</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#cluster" class="sidebar-link">Cluster</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#node" class="sidebar-link">Node</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#shard" class="sidebar-link">Shard</a></li></ul></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch/01_Elasticsearch.html#conclusion" class="sidebar-link">Conclusion</a></li></ul></li><li><a href="/BookELK/Elasticsearch/02_Index.html" class="sidebar-link">Index</a></li><li><a href="/BookELK/Elasticsearch/02_Document.html" class="sidebar-link">Document</a></li><li><a href="/BookELK/Elasticsearch/02_Mapping.html" class="sidebar-link">Mapping</a></li><li><a href="/BookELK/Elasticsearch/02_Aliases.html" class="sidebar-link">Index Aliases</a></li><li><a href="/BookELK/Elasticsearch/02_Analyzer.html" class="sidebar-link">Analyzer</a></li><li><a href="/BookELK/Elasticsearch/02_AnalyzerCh.html" class="sidebar-link">Analyzer ä¸­æ–‡åˆ†è©</a></li><li><a href="/BookELK/Elasticsearch/02_SearchAPI.html" class="sidebar-link">Search API</a></li><li><a href="/BookELK/Elasticsearch/02_Query.html" class="sidebar-link">Query DSL</a></li><li><a href="/BookELK/Elasticsearch/02_Aggregations.html" class="sidebar-link">Aggregations</a></li><li><a href="/BookELK/Elasticsearch/03_Cat.html" class="sidebar-link">Cat</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>kibana</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Logstash</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Beats</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Demo</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Elastic stack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="elasticsearch"><a href="#elasticsearch" class="header-anchor">#</a> ELasticsearch</h1> <p>ğŸ“— <strong>Chapter Objectives</strong></p> <ul><li>ELasticsearch æ›´å¤šåŸºç¤çŸ¥è­˜</li> <li>å¦‚åŒé€²è¡Œæ­£è¦çƒè³½å‰è¦å…ˆç†Ÿæ‚‰è¦å‰‡ï¼Œä½¿ç”¨ ELasticsearch å‰åŸºæœ¬ç›¸é—œåè©ä¹Ÿéœ€è¦ç•¥çŸ¥ä¸€äºŒ</li> <li>ç”±é—œè¯å‹æ•¸æ“šåº«çš„æ¦‚å¿µåˆ‡å…¥ Elasticsearch åŠ é€Ÿç†è§£é€Ÿåº¦</li> <li>Elasticsearch = ES(ç¸®å¯«)</li></ul> <p>ğŸ“˜ <strong>Reference</strong></p> <ul><li><a href="https://www.elastic.co/elasticsearch/" target="_blank" rel="noopener noreferrer">å®˜ç¶²<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.elastic.co/blog/what-is-an-elasticsearch-index" target="_blank" rel="noopener noreferrer">What is an Elasticsearch Index?(2013)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>ğŸ“•  <strong>Notice</strong></p> <p>åªæ˜¯åŸºæ–¼è‡ªèº«ç†è§£ä¸¦ä¸”è¨˜éŒ„ä¸‹ä¾†ï¼Œç›¸é—œçŸ¥è­˜è«‹çš†å·²å®˜æ–¹ç‚ºæœ€é«˜æº–å‰‡</p> <h2 id="more-about-elasticsearch"><a href="#more-about-elasticsearch" class="header-anchor">#</a> More About ELasticsearch</h2> <p>ELasticsearch æœ‰è‘— Scalability(å¯æ“´å±•) èˆ‡ Near real-time search(æ¥è¿‘å³æ™‚æœå°‹) çš„ç‰¹æ€§ï¼Œ<br>
åŒæ™‚ä¹Ÿæä¾›äº†é«˜å¯ç”¨(high availability)çš„é›†ç¾¤æ¶æ§‹ï¼Œ<br>
ELasticsearch æƒ³è§£æ±ºçš„æ ¸å¿ƒå•é¡Œå°±æ˜¯åœ¨æ•¸æ“šé‡å¤§çš„ç‹€æ³ä¸‹ä¹Ÿèƒ½ä¿æœ‰æœå°‹é€Ÿåº¦ï¼Œ<br>
ç•¶åˆä½œè€… Shay Banon åœ¨è¨­è¨ˆçš„æ™‚å€™ï¼Œä¸€é–‹å§‹å°±æ˜¯æœå‘åˆ†å¸ƒå¼éƒ¨å±¬çš„é¢ç›¸é–‹ç™¼ ELasticsearch<br>
ELasticsearch æ ¸å¿ƒè¦ç´ æœ‰ä¸‰å€‹:</p> <ul><li><font color="#63C5DA" size="4"><strong>Data in : documents and indices</strong></font></li> <li><font color="#63C5DA" size="4"><strong>Information out : search and analyze</strong></font></li> <li><font color="#63C5DA" size="4"><strong>Scalability and resilience</strong></font></li></ul> <p></p> <ul><li><p>ğŸ““ <font color="008000"><strong>é—œæ–¼ç³»çµ±è¨­è¨ˆçŸ¥è­˜è£œå……</strong></font></p> <ul><li><p>åˆ†æ•£å¼ç³»çµ±è¨­è¨ˆæº–å‰‡ CAP</p> <ul><li>Consistency (ä¸€è‡´æ€§)</li> <li>Availability (å¯ç”¨æ€§)</li> <li>Partition Tolerance (åˆ†å€å®¹å¿æ€§)</li></ul> <p>ğŸ“ ä¸€èˆ¬ä¾†èªªä¸€å€‹åˆ†æ•£å¼æ¶æ§‹ä¸‹ï¼Œä¸‰ç¨®ç‰¹æ€§ä¸­åªèƒ½æ»¿è¶³å…©ç¨®ï¼Œ<br>
Â Â Â Â Â Â æ‹¿CAPç†è«–å°æ¯”è³‡æ–™è™•ç†ä¹Ÿæœƒæœ‰ä»¥ä¸‹ä¸‰ç¨®ç‰¹æ€§:</p></li> <li><p>è³‡æ–™è™•ç†ç³»çµ±è¨­è¨ˆ</p> <ul><li>æ•¸æ“šé‡é¾å¤§</li> <li>è¿‘å³æ™‚è™•ç†</li> <li>è³‡æ–™æº–ç¢ºæ€§</li></ul> <p>ğŸ“ åŒç†ï¼Œåœ¨è³‡æ–™è™•ç†ä¸Šå¥½åƒä¹Ÿæœ‰é¡ä¼¼çš„æ¦‚å¿µ(ä¹‹å‰çœ‹åˆ°çš„ï¼Œæ‰¾ä¸åˆ°åŸæ–‡äº†...)ï¼Œ<br>
Â Â Â Â Â Â è€Œ Elasticsearch ç•¶ç„¶æ˜¯åšäº†æŸäº›å–æ¨ï¼Œä½¿ç”¨ä¸Šè«‹ä¾è‡ªèº«æƒ…æ³æŠŠæ¡</p> <ul><li>Elasticsearch æ¨æ£„çš„æ˜¯è³‡æ–™æº–ç¢ºæ€§ï¼Œä¸éåœ¨æŸäº›æ•¸æ“šé‡å·¨å¤§çš„æ‡‰ç”¨å ´æ™¯ä¸‹ï¼Œå·²ç¶“ä¸æœƒåœ¨ä¹é‚£ä¸€é»é»è³‡æ–™éŒ¯èª¤äº†</li> <li>è‹¥è¦æ»¿è¶³æ•¸æ“šé‡å·¨å¤§èˆ‡è³‡æ–™æº–ç¢ºæ€§å…©å€‹å› ç´ ï¼Œå¯ä»¥ä½¿ç”¨ Hadoop æˆ– HBase ...ä¾†è™•ç†ï¼Œä½†å°±ä¸å¯èƒ½ Realtime äº†</li> <li>è³‡æ–™é‡å°çš„æƒ…æ³ä¸‹ï¼Œä»€éº¼!ä½ èªªè³‡æ–™é‡å°çš„æƒ…æ³ï¼Œé‚£æ²’äº‹äº†</li></ul></li></ul></li></ul> <h2 id="rdbms-vs-elasticsearch"><a href="#rdbms-vs-elasticsearch" class="header-anchor">#</a> RDBMS vs. Elasticsearch</h2> <p>è¦ç­è§£ Elasticsearch å¯ä»¥å…ˆç”¨ RDBMS çš„æ¦‚å¿µä¾†å°æ¯”æœƒæ¯”è¼ƒå¥½ç†è§£ï¼Œä½†å¿…é ˆ<br> <font color="#FF0000" size="4">æ³¨æ„åªæ˜¯æ‹¿ä½¿ç”¨æ¦‚å¿µä¾†é¡æ¯”ï¼Œä¸¦é Elasticsearch æœ¬èº«è¨­è¨ˆæ˜¯ä¾ RDBMS çš„é‚è¼¯é–‹ç™¼ï¼Œå…©è€…åœ¨æœ¬è³ªä¸Šæ˜¯å¤©å·®åœ°åˆ¥</font><br>
ä»¥ä¸‹æ˜¯ä»¥ RDBMS çš„æ–¹å¼ç†è§£ Elasticsearch :<br></p> <ul><li>ğŸ““ <font color="008000"><strong>Typeè£œå……</strong></font></li></ul> <p>Â Â Â Â Type é€™å€‹æ¦‚å¿µå·²ç¶“åœ¨æ–°ç‰ˆæœ¬ 8.x ä¸­ç§»é™¤ï¼Œ<br>
Â Â Â Â è€Œåœ¨ 7.x ç‰ˆæœ¬ä¸­ Type å·²ç¶“è¢«å®šç¾©ç‚ºé è¨­çš„ _docï¼Œ<br>
Â Â Â Â å› ç‚ºåœ¨ Elasticsearch ä¸­ä¸€åˆ‡çš†æ˜¯ç´¢å¼•ï¼Œä¸éœ€è¦å†é¡å¤–åŠƒåˆ†ä¸€å±¤ Type ä¾†åˆ†é¡ï¼Œæ–¼æ˜¯è¢«ç•¶æˆéåº¦è¨­è¨ˆè€Œ<font color="#FF0000" size="4">æ£„ç”¨</font><br></p> <table><thead><tr><th>RDBMSâ€ƒâ€ƒâ€ƒâ€ƒ</th> <th>Elasticsearchâ€ƒâ€ƒ</th></tr></thead> <tbody><tr><td>Database</td> <td>Index</td></tr> <tr><td><s>Table</s></td> <td><s>Type</s></td></tr> <tr><td>Row</td> <td>Document</td></tr> <tr><td>Column</td> <td>Fields</td></tr> <tr><td>Schema</td> <td>Mapping</td></tr> <tr><td>SQL</td> <td>Query DSL</td></tr></tbody></table> <p></p> <p>ç”¨æœ€ç°¡å–®çš„æ–¹å¼ï¼Œå»ºç«‹&quot;å„²å­˜è³‡æ–™çš„å®¹å™¨&quot;åˆ°&quot;å°‡è³‡æ–™å„²å­˜åˆ°å¯¦é«”ä½ç½®&quot;çš„å¯¦ç”¨è§’åº¦ä¸Šä¾†åˆ‡å…¥ :</p> <ul><li><p><font color="#63C5DA"><strong>RDBMS</strong></font></p> <ul><li>å»ºè³‡æ–™åº«</li> <li>å»ºè³‡æ–™è¡¨</li> <li>è¨­è¨ˆæ¬„ä½</li> <li>æ’å…¥è³‡æ–™</li></ul> <p><img src="/BookELK/assets/img/RDBMSflow.9f678a67.png" alt="RDBMSflow"></p></li> <li><p><font color="#63C5DA"><strong>Elasticsearch</strong></font></p> <ul><li>å»ºç«‹ç´¢å¼• (Index)</li> <li>è¨­è¨ˆæ˜ å°„ (Mapping)ï¼Œæ­¤æ­¥é©Ÿä¹Ÿä¸ä¸€å®šè¦æœ‰</li> <li>æ’å…¥æ–‡ä»¶ (Document)</li></ul> <p><img src="/BookELK/assets/img/ESflow.d4596412.png" alt="ESflow"></p></li></ul> <p>æœ€å¾Œä¾†çœ‹ä¸€ä¸‹å®˜æ–¹éƒ¨è½æ ¼ä¸Šé¢çš„è«–è¿°(2013å¹´ï¼Œæ‰€æœ‰é‚„æœ‰Typeçš„æ¦‚å¿µ)</p> <blockquote><p>The easiest and most familiar layout clones what you would expect from a relational database.<br>
You can (very roughly) think of an index like a database.<br>
â— MySQL =&gt; Databases =&gt; Tables =&gt; Columns/Rows<br>
â— Elasticsearch =&gt; Indices =&gt; Types =&gt; Documents with Properties</p></blockquote> <p>Elasticsearch ä¸€è©æ‹†é–‹ä¾†çœ‹å°±æ˜¯ Elastic + Searchï¼Œ<br>
Elastic æœ‰éˆæ´»çš„æ„æ€ï¼›Search å‰‡æ˜¯æœå°‹ï¼Œ<br>
ç‚ºäº†è®“ä½¿ç”¨è€…èƒ½éˆæ´»æœå°‹ï¼ŒElasticsearch åœ¨ä¸€äº›æ ¼å¼å®šç¾©ä¸Šç›¸å°éˆæ´»ï¼Œ<br>
ä¸éè¦ç™¾åˆ†ä¹‹ç™¾ç™¼æ® Elasticsearch çš„æœå°‹é€Ÿåº¦é‚„æ˜¯å»ºè­°å°‡ &quot;éœ€æœå°‹çš„æ¬„ä½&quot; çš„å®šç¾©çµ¦ç¢ºå®šä¸‹ä¾†<br>
ä¸ç„¶å®˜æ–¹å°±ä¸æœƒæœ‰æ–‡ä»¶æ˜¯å°ˆé–€é—¡è¿° Mapping é€™å€‹éƒ¨ä»½äº†<br> <br>
å¦ä¸€å€‹ Elasticsearch èˆ‡ RDBMS çš„å·¨å¤§å·®ç•°å°±æ˜¯ <font color="#FF0000">Elasticsearch ä¸å…·å‚™ Transaction çš„æ¦‚å¿µ</font>ï¼Œ<br>
ä½†å–®å€‹è«‹æ±‚ä¸‹æ˜¯ä¿æœ‰ ACID ç‰¹æ€§ï¼Œé›–ç„¶è¬›èµ·ä¾†å¥½åƒæœ‰é»çŸ›ç›¾!?<br>
ä¸éå¯¦éš›ä½¿ç”¨é Elasticsearch API ä¹‹å¾Œï¼Œå°±æœƒæœ‰æ¯”è¼ƒæ·±åˆ»çš„äº†è§£ (å‰ææ˜¯å¿…é ˆäº†è§£RDBMS ACID And Transaction)<br> <br>
æ‰€ä»¥åœ¨çœŸå¯¦çš„æ‡‰ç”¨å ´æ™¯ä¸‹ Elasticsearch ä¸æœƒå–ä»£ RDBMSï¼Œåè€Œæ˜¯å…©è€…ä½µè¡Œç›¸è¼”ç›¸æˆï¼Œ<br>
RDBMS è² è²¬æ’å…¥èˆ‡æ›´æ–°è³‡æ–™ï¼Œå†æŠŠè³‡æ–™åŒæ­¥åˆ° Elasticsearch é€²è¡Œæœç´¢ã€‚</p> <h2 id="index"><a href="#index" class="header-anchor">#</a> Index</h2> <p>Index (ç´¢å¼•)ç‚º Elasticsearch çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼Œ<br>
æ ¸å¿ƒä¸‰è¦ä¹‹ä¸€ä¾¿æ˜¯ <code>Data in : documents and indices</code>ï¼Œ<br>
ç•¶è³‡æ–™å¾€ Elasticsearch è¼¸å…¥æ™‚ï¼Œå…©å€‹é—œéµä¾¿æ˜¯ <strong>documents</strong> and <strong>indices</strong>ï¼Œ<br>
è‹¥æ˜¯èªª<font color="#FF0000">æœå°‹å¼•æ“ç‚º Elasticsearch çš„æ ¸å¿ƒæ¦‚å¿µï¼ŒIndex å°±æ˜¯æ”¯æ’é€™å€‹æ ¸å¿ƒæ¦‚å¿µçš„åŸºçŸ³</font>ï¼Œ<br>
è‹¥è¦åœ¨ ELK Stack ç›¸é—œæ‡‰ç”¨ä¸Šæœ‰è‰¯å¥½çš„ä½¿ç”¨é«”é©—ï¼Œå‹™å¿…è¦æŒæ¡ä¸€ä¸‹ Indexï¼Œ<br>
è‡ªèº«çš„å¿ƒå¾—æ˜¯ Elasticsearch Index é€™å€‹æ±è¥¿&quot;æ¥µç«¯ç¥ç§˜&quot;</p> <ul><li>ç´¢å¼•ç‚ºæ–‡ä»¶çš„é›†åˆï¼Œç°¡å–®ä¾†èªªå°±æ˜¯æŠŠåŒé¡å‹çš„ documents è—‰ç”± Index é›†åˆå†ä¸€èµ·ï¼Œ<br>
ç•¶ç„¶ç´¢å¼•çš„è¨­è¨ˆç‰½æ¶‰åˆ°æ•´é«”æœå°‹çš„é€Ÿåº¦ï¼Œå‡è¨­æŠŠç³»çµ±ä¸­æ‰€æœ‰çš„ documents éƒ½ç”¨ä¸€å€‹ Index å­˜èµ·ä¾†<br>
æƒ³ç•¶ç„¶çˆ¾...</li> <li>è€Œä¸€å€‹ Elasticsearch Index åˆæœƒåˆ†å¸ƒåœ¨ä¸€å€‹æˆ–å¤šå€‹ Shard ä¸­ï¼Œè€Œæ¯ä¸€å€‹ Shard åˆæœƒæœ‰è‡ªèº«çš„ Lucene Index</li> <li>Inverted Index</li></ul> <p><s>é€™å°ç¯€æœ‰é»é›£å¯«.. å…ˆæ“±ç½®ä¸€ä¸‹</s></p> <h3 id="inverted-index"><a href="#inverted-index" class="header-anchor">#</a> Inverted Index</h3> <p>ğŸŒ <font color="#63C5DA" size="4"><strong>www.elastic.co</strong></font></p> <blockquote><p>Elasticsearch uses a data structure called an inverted index that supports very fast full-text searches.</p></blockquote> <p>ğŸŒ <font color="#63C5DA" size="4"><strong>Wikipedia</strong></font></p> <blockquote><p>å€’æ’ç´¢å¼•ï¼ˆè‹±èªï¼šInverted indexï¼‰ï¼Œä¹Ÿå¸¸è¢«ç¨±ç‚ºåå‘ç´¢å¼•ã€ç½®å…¥æª”æ¡ˆæˆ–åå‘æª”æ¡ˆï¼Œ<br>
æ˜¯ä¸€ç¨®ç´¢å¼•æ–¹æ³•ï¼Œè¢«ç”¨ä¾†å„²å­˜åœ¨å…¨æ–‡æœå°‹ä¸‹æŸå€‹å–®è©åœ¨ä¸€å€‹æ–‡ä»¶æˆ–è€…ä¸€çµ„æ–‡ä»¶ä¸­çš„å„²å­˜ä½ç½®çš„å°æ˜ ã€‚<br>
å®ƒæ˜¯æ–‡ä»¶æª¢ç´¢ç³»çµ±ä¸­æœ€å¸¸ç”¨çš„è³‡æ–™çµæ§‹ã€‚</p></blockquote> <p><font color="#FF0000"><strong>Elasticsearch ä½¿ç”¨ Inverted Index çš„è³‡æ–™çµæ§‹ä¾†å¯¦ç¾å¿«é€Ÿçš„å…¨æ–‡æœå°‹</strong></font>ï¼Œ<br>
é—œæ–¼åå‘ç´¢å¼•æˆ–ç¨±å€’æ’ç´¢å¼•å·²ç¶“æ˜¯è€ç”Ÿå¸¸è«‡äº†(Googleä¸€ä¸‹å°±ä¸€å †)ï¼Œ<br>
ç°¡å–®çš„è¨˜éŒ„ä¸€ä¸‹</p> <p><img src="/BookELK/assets/img/InvertedIndexExample.f180ffb4.png" alt="invertedindexexample"></p> <ul><li><font color="#63C5DA" size="4"><strong>ç°¡ç•¥çš„è½‰ç½®æµç¨‹</strong></font></li></ul> <p>è‹¥è¦å»ºç«‹ Inverted Indexï¼Œé¦–å…ˆæ‰€æœ‰çš„ Document æœƒå…ˆç¶“éåˆ†è©ã€åˆ†æã€åœç”¨è©ã€å­—å…ƒè½‰æ›å¾Œï¼Œ<br>
å‰²æˆä¸€å€‹ä¸€å€‹æœ€å°çš„å–®è©ï¼Œå†ç”±é€™äº›å–®è©é›†åˆæˆ Inverted Indexï¼Œ<br>
â€»æ‰€ä»¥ç•¶æˆ‘å€‘æœå°‹ <code>what</code> çš„æ™‚å€™ï¼Œæˆ‘å€‘å¯ä»¥çŸ¥é“ <code>what</code> é€™å€‹é—œéµå­—åœ¨æ–‡ä»¶IDç‚º <code>0,1</code> é€™å…©å€‹æ–‡ä»¶ä¸­ï¼Œä¾¿ä¸ç”¨åœ¨æ¯å€‹æ–‡ä»¶å°‹è¨ªï¼Œ<br>
ä»¥ Wiki çš„ä¸‰å¥æ–‡å­—ç‚ºä¾‹å­ï¼Œæµç¨‹å¦‚ä¸‹åœ–:<br> <br> <img src="/BookELK/assets/img/Invertedindexflow.cd48dd0b.png" alt="invertedindexflow"><br></p> <p>è‹¥ä»¥ Forward Index (ç´¢å¼•) vs. Invert Index (åå‘ç´¢å¼•) ä¾†åˆ‡å…¥ï¼Œ<br>
Invert Index è³‡æ–™çµæ§‹æ˜¯å…¸å‹çš„æœå°‹å¼•æ“æª¢ç´¢æ¼”ç®—æ³•é‡è¦çš„éƒ¨åˆ†ï¼Œ<br>
äº‹å¯¦ä¸Šæ­£å› ç‚º Invert Index çš„ç‰¹æ€§ï¼ŒInvert Index ä¹Ÿæ˜¯æ–‡ä»¶æª¢ç´¢ç³»çµ±ä¸­æœ€å¸¸ç”¨çš„è³‡æ–™çµæ§‹ï¼Œ<br>
Forward Index vs. Invert Index å…©è€…æ¯”è¼ƒå¦‚ä¸‹åœ–:<br> <br> <img src="/BookELK/assets/img/forwardvsinvertedindex.381b84c7.png" alt="forwardvsinvertedindex"><br></p> <h3 id="inverted-index-for-elasticsearch"><a href="#inverted-index-for-elasticsearch" class="header-anchor">#</a> Inverted Index For Elasticsearch</h3> <p>æ›´æ·±å…¥çš„ä¾†æ¢è¨ Elasticsearch å°æ–¼ Inverted Index çš„å¯¦ç¾<br> <s>é€™å€‹è¦æ•´ç†å¾ˆä¹…ï¼Œå…ˆæŠŠå¤§ç¶±æ‰“å¥½</s>(æœªå®Œå¾…çºŒ)</p> <h2 id="document"><a href="#document" class="header-anchor">#</a> Document</h2> <blockquote><p>Elasticsearch is a distributed document store.<br>
Instead of storing information as rows of columnar data,<br>
Elasticsearch stores complex data structures that have been serialized as JSON documents.</p></blockquote> <ul><li><p><font color="#63C5DA" size="4"><strong>é‡é» =&gt;</strong></font> <code>Elasticsearch is a distributed document store</code><br> <strong>Elasticsearch æ˜¯ä¸€å€‹<font color="#FF0000">åˆ†å¸ƒå¼</font>çš„<font color="#FF0000">æ–‡ä»¶è³‡æ–™åº«</font></strong><br> <strong>Elasticsearch æ˜¯ä¸€å€‹<font color="#FF0000">åˆ†å¸ƒå¼</font>çš„<font color="#FF0000">æ–‡ä»¶è³‡æ–™åº«</font></strong><br> <strong>Elasticsearch æ˜¯ä¸€å€‹<font color="#FF0000">åˆ†å¸ƒå¼</font>çš„<font color="#FF0000">æ–‡ä»¶è³‡æ–™åº«</font></strong></p></li> <li><p><font color="#63C5DA" size="4"><strong>Index èˆ‡ Documents çš„é—œä¿‚</strong></font><br>
æœ€ <font color="FF4500"><strong>ç°¡å–®</strong></font> ä¾†èªªå°±æ˜¯ä¸€å€‹ Index è£¡é¢ï¼Œæœƒæœ‰å¾ˆå¤šåŒå±¬æ€§çš„ Documents<br>
(ç•¶ç„¶å¯¦éš›å ´æ™¯ä¸‹é æ¯”é€™å€‹è¤‡é›œå¾—å¤šï¼Œé‚„æœ‰ Node; Shard; é‚£äº›æœ‰çš„æ²’çš„)<br> <br> <img src="/BookELK/assets/img/IndexandDocument.2f1db41a.png" alt="IndexandDocument"></p></li> <li><p><font color="#63C5DA" size="4"><strong>æ•¸æ“šæœ€å°å–®ä½</strong></font></p> <p>Document å·²ç¶“æ˜¯ Elasticsearch å„²å­˜è³‡æ–™å–®å…ƒä¸­æœ€å°çš„å–®ä½äº†</p></li> <li><p><font color="#63C5DA" size="4"><strong>JSON Documents</strong></font></p> <blockquote><p>Elasticsearch stores complex data structures that have been serialized as JSON documents</p></blockquote> <p>å„²å­˜é€² Elasticsearch çš„è³‡æ–™éƒ½å°‡è¢«åºåˆ—åŒ–ç‚º JSON documentsï¼Œ<br>
æ‰€ä»¥ documents é€šå¸¸ä»¥ JSON ä¾†è¡¨ç¤ºï¼Œ<br>
äº‹å¯¦ä¸Šï¼Œå†ä½¿ç”¨ Elasticsearch æ™‚ä¹Ÿéƒ½é€é HTTP èˆ‡ JSON ä¾†èˆ‡ Elasticsearch æºé€šå±…å¤š</p></li> <li><p><font color="#63C5DA" size="4"><strong>Unique Id</strong></font></p> <p>æ¯å€‹ Document æ¥æœ‰è‡ªå·±çš„å”¯ä¸€ IDï¼Œ<br>
ä¸ç®¡æ˜¯åœ¨å»ºç«‹çš„æ™‚å€™ä½¿ç”¨è€…è³¦äºˆï¼Œæˆ–æ˜¯ç”±ç³»çµ±è‡ªèº«é…çµ¦ï¼Œ<br>
é€šå¸¸è®“ç³»çµ±æœ¬èº«ç®¡ç†æœƒæ˜¯æ¯”è¼ƒæ˜æ™ºçš„é¸æ“‡</p></li> <li><p><font color="#63C5DA" size="4"><strong>Schema-less</strong></font></p> <blockquote><p>Elasticsearch also has the ability to be schema-less</p></blockquote> <p>Schema-less ç‚ºä¸€ç¨®å½ˆæ€§çš„å„²å­˜çµæ§‹ï¼Œä¸¦ä¸åƒ…é™å­˜åœ¨æ–¼ Elasticsearch ä¸­ï¼Œ<br>
MongoDB ...ç­‰ç­‰çš„è³‡æ–™åº«ï¼Œä¹Ÿæ˜¯å…·å‚™ Schema-less å±¬æ€§ï¼Œ<br>
Schema-less æä¾›äº†ä»€éº¼ç‰¹æ€§?</p> <blockquote><p>which means that documents can be indexed without explicitly specifying how to handle each of the different fields that might occur in a document.</p></blockquote> <p>åœ¨å­˜å„²è³‡æ–™æ™‚ä¸éœ€è¦äº‹å…ˆå®šç¾©ç¾å€‹æ–‡ä»¶ä¸­çš„æ ¼å¼(fields)ä¾¿å¯å°‡æ–‡ä»¶å„²å­˜ï¼Œ<br>
Elasticsearch ä¸­æä¾› <font color="FF4500">Dynamic mapping</font> çš„æ©Ÿåˆ¶ï¼Œ<br>
åœ¨æ–‡ä»¶é€²åˆ° Elasticsearch Index æ™‚æœƒè‡ªå‹•çš„åˆ¤åˆ¥ fields ä¸¦æŠŠ fields æ·»åŠ é€² Index ä¸­ï¼Œ</p> <blockquote><p>â€‹just start indexing documents and Elasticsearch will detect and map booleans,<br>
floating point and integer values, dates, and strings to the appropriate Elasticsearch data types.</p></blockquote> <p>ä½¿ç”¨è€…åƒ…éœ€è¦å¾€ç´¢å¼•ä¸­é–“æ·»åŠ æ–‡ä»¶ï¼ŒElasticsearch æœƒè‡ªå‹•å¹«ä½ åˆ¤åˆ¥å‹æ…‹ï¼Œ<br>
éœ€è¦æ³¨æ„çš„æ˜¯ Dynamic mapping ä¹Ÿä¸æ˜¯å¦‚æ­¤çš„å®Œç¾ï¼Œ<br>
æ‰€ä»¥æœ‰æ™‚å€™é‚„æ˜¯éœ€è¦ä½¿ç”¨è€…è‡ªå·±å®šç¾©</p></li> <li><p>ğŸ““ <font color="008000"><strong>Schema-less çŸ¥è­˜è£œå……</strong></font></p> <p>Schema-less é›–ç„¶çœ‹ä¼¼æ–¹ä¾¿å…¶å¯¦é‚„æ˜¯æœ‰äº›å•é¡Œå­˜åœ¨ 1. éœ€è¦å¤§é‡ Index ; 2.å¼±è³‡æ–™æ­£ç¢ºæ€§<br>
æ‰€ä»¥ MongoDB è®Šæˆæœ‰é»é¡ä¼¼ Dynamic schemaï¼Œ<br>
Elasticsearch å‰‡æ˜¯æœ‰ Dynamic mappingï¼Œ<br>
åˆ°è‹¥è¦åœ¨æœ¬è³ªä¸Šæ”»å…‹ Schema-less æœ‰å¦ä¸€å€‹æ±è¥¿ï¼ŒWide Column Stores - <code>Cassandra</code></p></li> <li><p>ğŸ““ <font color="008000"><strong>é—œæ–¼ NoSQL çŸ¥è­˜è£œå……</strong></font></p> <p>Elasticsearch å±¬æ–¼æ–‡ä»¶å‹è³‡æ–™åº«ï¼Œ<br>
Google <code>NoSQL</code> æ‹‰åˆ°æ–‡ä»¶å„²å­˜åˆ—è¡¨å°±æœƒçœ‹åˆ°äº†ï¼Œ<br>
ç›®å‰å°æ–¼ NoSQL åˆ†é¡çš„ä¸»æµèªªæ³•ï¼Œå¤§é«”åˆ†æˆå››å€‹:</p> <ul><li>æ–‡ä»¶å‹è³‡æ–™åº«</li> <li>Key-value éµå€¼å°è³‡æ–™åº«</li> <li>åœ–è³‡æ–™åº«</li> <li>åˆ—è³‡æ–™åº«</li></ul></li></ul> <h3 id="mapping"><a href="#mapping" class="header-anchor">#</a> Mapping</h3> <blockquote><p>Mapping is the process of defining how a document, and the fields it contains, are stored and indexed.</p></blockquote> <p>åœ¨ Elasticsearch ä¸­æ¯å€‹ Document å…§åŒ…å«å¤šå€‹ fieldsï¼Œè€Œä¸”é€™äº› fields æœƒæœ‰å±¬æ–¼è‡ªå·±çš„ data typeï¼Œ<br>
ç•¶è³‡æ–™ä»¥ Document é€²å…¥ Elasticsearch ä¸­æ™‚ï¼Œæœƒè‡ªå‹•çš„ Mapping æ¯å€‹ fields çš„ data typeï¼Œ<br>
æ­¤æ™‚æœ‰å…©ç¨®æƒ…æ³ï¼Œ<br>
ç•¶é€™å€‹æ¬„ä½æœ‰äº‹å…ˆè¢«å®šç¾©æ™‚ï¼Œæœƒæ ¹æ“šå·²å®šç¾©çš„è¦å‰‡ Mappingï¼Œ<br>
è€Œæ²’æœ‰å®šç¾©çš„æ¬„ä½å‰‡æœƒç”± Dynamic Mapping åˆ¤æ–·æ­¤æ¬„ä½çš„è³‡æ–™å‹æ…‹<br> <br>
åœ¨å¯¦å‹™ä½¿ç”¨ä¸Šæœ€å¥½äº‹å…ˆå®šç¾©å¥½ Mappingï¼Œ<br>
å› ç‚º<font color="#FF0000" size="4">ä¸€å€‹ Index çš„ Mapping ä¸€æ—¦å»ºç«‹ä¾¿ä¸èƒ½ä¿®æ”¹</font>ï¼Œ<br>
Elasticsearch ä¸­å­˜åœ¨ä¸€ç¨® Aliases çš„æ©Ÿåˆ¶ï¼Œå¯è®“ä½¿ç”¨è€…è¼ƒç‚ºæ–¹ä¾¿ç¶­è­· Index ä¹‹æ›´è¿­ï¼Œ<br>
ä½†é‚„æ˜¯è¦ç¶“é Reindex çš„å‹•ä½œæ‰èƒ½å®Œæˆæ›´æ–°ï¼Œ<br>
ä»¥ä¸‹ç²—ç•¥ä»‹ç´¹ä¸€ä¸‹å…©ç¨® Mapping</p> <ul><li>ğŸ““ <font color="008000"><strong>Mapping Types çŸ¥è­˜è£œå……</strong></font></li></ul> <blockquote><p>Elasticsearch 8.0.0 no longer supports mapping types.<br>
For details on how to migrate your clusters away from mapping types,<br>
see the removal of types documentation for the 7.x release.</p></blockquote> <p>éš¨è‘— types çš„æ£„ç”¨ï¼ŒElasticsearch 8.0.0 å·²ç¶“ä¸æä¾› Mapping Types æ©Ÿåˆ¶ï¼Œ
ç¨å¾®æ³¨æ„ä¸€ä¸‹å°±å¥½</p> <h3 id="dynamic-mapping"><a href="#dynamic-mapping" class="header-anchor">#</a> Dynamic mapping</h3> <blockquote><p>When Elasticsearch detects a new field in a document,<br>
it dynamically adds the field to the type mapping by default.</p></blockquote> <p>å®˜æ–¹æ–‡ä»¶æŒ‡åç•¶æœ‰ä¸€å€‹æ–°å¾— field åœ¨æ–‡ä»¶ä¸­æ™‚ï¼ŒElasticsearch å°‡æœƒè‡ªå‹•å¾—é€²è¡Œ type mappingï¼Œ
æ„å³ Elasticsearch å¹«æˆ‘å€‘åˆ¤æ–· JSON ä¸­æ¬„ä½çš„è³‡æ–™å‹æ…‹ï¼Œé€™å€‹æ©Ÿåˆ¶ç¨±ç‚º <code>Dynamic field mapping</code></p> <blockquote><p>Dynamic templates allow you greater control of how Elasticsearch maps your data beyond the default dynamic field mapping rules.</p></blockquote> <p>æ­¤å¤– Elasticsearch ä¹Ÿæä¾› <code>Dynamic templates</code> å¯ä»¥è®“ä½¿ç”¨è€…è©³ç´°è‡ªè¨‚è‡ªå·±éœ€è¦çš„æ˜ å°„è¦å‰‡ <code>dynamic field mapping rules</code> (ä¸­æ–‡å¯¦åœ¨ä¸å¥½è¬›)</p> <h3 id="explicit-mapping"><a href="#explicit-mapping" class="header-anchor">#</a> Explicit mapping</h3> <p>Explicit mapping å¯æº–ç¢ºå®šç¾©æ¬„ä½å‹æ…‹ï¼Œç•¶æˆ‘å€‘å·²ç¶“çŸ¥é“ Document æ•¸æ“šæ˜¯ä»€éº¼ï¼Œ<br>
å¯ä»¥å¦‚åŒå®šç¾©è³‡æ–™è¡¨å‹æ…‹ä¸€æ¨£ï¼Œ<br>
ä¾†å®šç¾©æ–‡ä»¶ä¸­çš„æ¬„ä½å‹æ…‹å…¶ä¸­åŒ…æ‹¬(åŸæ–‡æ¯”è¼ƒè²¼åˆ‡...):</p> <ul><li><font color="#63C5DA">Which string fields should be treated as full text fields.</font><br>
é‚£äº› string fields è¦ä½¿ç”¨ full text fields</li> <li><font color="#63C5DA">Which fields contain numbers, dates, or geolocations.</font><br>
é‚£äº› fields æ˜¯æ•¸å­—ã€æ—¥æœŸã€åœ°ç†è³‡è¨Š</li> <li><font color="#63C5DA">The format of date values.</font><br>
æ—¥æœŸæ ¼å¼</li> <li><font color="#63C5DA">Custom rules to control the mapping for dynamically added fields.</font><br>
é€™å€‹ fields å¯ä»¥ä½¿ç”¨çš„ Dynamic field mapping æ–¹å¼</li></ul> <blockquote><p>Use runtime fields to make schema changes without reindexing.</p></blockquote> <p>å¦å¤–ä½¿ç”¨ <code>runtime fields</code> å¯ä»¥åœ¨ä¸ç”¨ reindexing çš„æƒ…æ³ä¸‹é€²è¡Œå‹æ…‹çš„æ›´æ–°ï¼Œ<br>
ä½†å…¶å‰¯ä½œç”¨å°±æ˜¯æœç´¢æ•ˆç‡çš„é™ä½ï¼Œè«‹è‡ªå·±è¡¡é‡å†ä¸‰</p> <h3 id="field"><a href="#field" class="header-anchor">#</a> Field</h3> <p>æ²’ç”šéº¼ç‰¹åˆ¥çš„å°±æ˜¯ä¸€å€‹ Fieldï¼Œæ³¨æ„ä¸€ä¸‹é€™å€‹ Field æ˜¯ä¸æ˜¯è¦è·‘å…¨æ–‡ç´¢å¼•å³å¯ï¼Œä¾‹å¦‚:<br>
è¢«è¨­å®šæˆ <code>text</code> é¡å‹çš„ Field æœƒé€²è¡Œå…¨æ–‡æª¢ç´¢åˆ†æï¼Œ<br>
è¢«è¨­å®šæˆ <code>keyword</code> é¡å‹çš„åƒ…æä¾›æŸ¥è©¢ç¯©é¸æˆ–å…¶ä»–èšåˆæ“ä½œ......ç­‰ç­‰</p> <p>å¦å¤–éœ€è¦çŸ¥é“ä¸€å€‹ <code>Multi-fields</code> æ©Ÿåˆ¶ï¼Œ
ç”¨ä¾†å°åŒä¸€å€‹ field è³¦äºˆä¸åŒçš„å±¬æ€§</p> <blockquote><p>Multi-fields,It is often useful to index the same field in different ways for different purposes.</p></blockquote> <h3 id="metadata-fields"><a href="#metadata-fields" class="header-anchor">#</a> Metadata fields</h3> <blockquote><p>Each document has metadata associated with it, such as the _index and _id metadata fields.</p></blockquote> <p>æ¯å€‹ document é€šå¸¸æœ‰è‘—è‡ªå·±çš„ Metadataï¼Œå¸¸è¦‹çš„æœ‰ <code>_index</code> æ–‡ä»¶æ‰€åœ¨ç´¢å¼•; <code>_id</code> æ–‡ä»¶å”¯ä¸€Id</p> <h3 id="field-data-types"><a href="#field-data-types" class="header-anchor">#</a> Field data types</h3> <blockquote><p>Each field has a field data type, or field type.</p></blockquote> <p>æ¯å€‹ Field éƒ½æœ‰è‡ªå·±çš„ Field data types <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html" target="_blank" rel="noopener noreferrer">è©³è¦‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
(é è¨ˆæœƒå¯«åœ¨ Mapping é‚£å€‹ç« ç¯€)</p> <h2 id="search"><a href="#search" class="header-anchor">#</a> Search</h2> <blockquote><p>The Elasticsearch REST APIs support structured queries, full text queries, and complex queries that combine the two.<br>
é‹ç”¨ Elasticsearch ä¾†é€²è¡Œæœå°‹åªæœ‰å¹¾å€‹é‡é»:</p></blockquote> <ul><li><font color="#63C5DA"><strong>çµæ§‹åŒ–æŸ¥è©¢ + å…¨æ–‡æª¢ç´¢æŸ¥è©¢</strong></font></li> <li><font color="#63C5DA"><strong>REST APIs</strong></font></li> <li><font color="#63C5DA"><strong>Query DSL (Domain Specific Language)</strong></font></li> <li><font color="#63C5DA"><strong><s>å…¶å¯¦é‚„æœ‰ SQL-style queries</s></strong></font></li></ul> <p>å…¶ä»–è«‹è¦‹æœå°‹é¡çš„ç­†è¨˜...</p> <h2 id="analyzer"><a href="#analyzer" class="header-anchor">#</a> Analyzer</h2> <blockquote><p>Elasticsearch aggregations enable you to build complex summaries of your data and gain insight into key metrics, patterns, and trends.</p></blockquote> <p>æ©... å°±æ˜¯ Elasticsearch ä¹Ÿæœ‰æä¾›<code>èšåˆæŸ¥è©¢</code>..OKå§.. (Â´ï¼Ï‰ï¼`)</p> <p>å–”... é‚„æœ‰<code>machine learning</code>ï¼Œå“ªæ¬¡ä¸ machine learning å°å§ (Â´-Ï‰-ï½€)</p> <h2 id="distributed-document-store"><a href="#distributed-document-store" class="header-anchor">#</a> Distributed Document Store</h2> <p><strong>Elasticsearch æ˜¯ä¸€å€‹<font color="#FF0000">åˆ†å¸ƒå¼</font>çš„<font color="#FF0000">æ–‡ä»¶è³‡æ–™åº«</font></strong><br>
Elasticsearch æ˜¯ä¸€å€‹å…·æœ‰åˆ†å¸ƒå¼æ¶æ§‹ç‰¹å¾µçš„æ‡‰ç”¨ï¼Œæ‰€ä»¥æœƒæœ‰é›†ç¾¤é€™å€‹æ¦‚å¿µï¼Œ<br>
æ•´å€‹ Elasticsearch çš„çœŸé¢ç›®å…¶å¯¦æ¯”è¼ƒåƒé€™å€‹æ¨£å­ï¼Œå¦‚ä¸‹åœ–:</p> <p><img src="/BookELK/assets/img/esarchitecture.41996389.png" alt="EsCluster"></p> <h3 id="cluster"><a href="#cluster" class="header-anchor">#</a> Cluster</h3> <p>Elasticsearch Cluster ä¸€å€‹Elasticsearchçš„é›†ç¾¤ä¸­å¯ä»¥åŒ…å«ä¸€å€‹æˆ–å¤šå€‹ Nodeï¼Œ<br>
é€šå¸¸ä½¿ç”¨ä¸Šæˆ‘å€‘å¯ä»¥æ ¹æ“šéœ€æ±‚å°é›†ç¾¤ä¸­çš„ç¯€é»é€²è¡Œç·¨æ’ï¼Œ<br>
è—‰ç”±é›†ç¾¤çš„ç‰¹æ€§å¯¦ç¾<font color="#FF0000" size="4"><strong>æ°´å¹³æ“´å……</strong></font>ï¼Œ<br>
åŒæ™‚å¯ä»¥è—‰ç”±é›†ç¾¤ä¾†æä¾›<font color="#FF0000" size="4"><strong>é«˜å¯ç”¨</strong></font>çš„æœå‹™ç’°å¢ƒ ( High availability services )ï¼Œ</p> <ul><li><p>ğŸ““ <font color="008000"><strong>High availability çŸ¥è­˜è£œå……</strong></font></p> <p>åœ¨åˆ†å¸ƒå¼ç³»çµ±è¨­è¨ˆä¸­&quot;é«˜å¯ç”¨&quot;æ˜¯ä¸€å®šæœƒè¢«è¨è«–åˆ°çš„å•é¡Œï¼Œ<br>
å¸¸è¦‹çš„è§£æ±ºæ–¹æ¡ˆéƒ½æœ‰é‡å°é«˜å¯ç”¨çš„æè¿° Ex: Redis,Kafkaï¼Œ<br>
å¯ä»¥åƒè€ƒæ¯”è¼ƒå…¶ä¸­çš„ä½œæ³•ï¼Œä¸¦æ‡‰ç”¨åœ¨ç³»çµ±è¨­è¨ˆä¸Š</p></li></ul> <h3 id="node"><a href="#node" class="header-anchor">#</a> Node</h3> <p>ç”±æ¶æ§‹åœ–å¯ä»¥è¦‹å¾—ï¼Œä¸€å€‹ Elasticsearch Cluster ä¸­æœƒåŒ…å«æ•¸å€‹ Nodeï¼Œ<br>
æ¯å€‹ Node çš†å¯ä»¥è¦–ç‚ºä¸€å€‹ç¨ç«‹çš„ Elasticsearch æ‡‰ç”¨ï¼Œ<br>
æ¯å€‹ Node éƒ½æ‡‰è©²åœ¨ä¸€å€‹&quot;ç¨ç«‹&quot;çš„ç’°å¢ƒä¸Šé‹è¡Œ (ex: container or VM)
åœ¨æ¸¬è©¦ç’°å¢ƒä¸Šå¯ä»¥å°‡ Node å»ºç½®åœ¨åŒä¸€ä¸»æ©Ÿä¸Šé¢ï¼Œ<br>
è‹¥æ˜¯å¯¦éš›æ‡‰ç”¨çš„ç”Ÿç”¢ç’°å¢ƒï¼Œé‚„æ˜¯å»ºè­°å°‡ä¸åŒçš„ç¯€é»ç¨ç«‹åˆ°ä¸åŒçš„ä¸»æ©Ÿä¸Šï¼Œä»¥ä¿è­‰é«˜å¯ç”¨çš„ç‰¹æ€§</p> <p>åœ¨ Elasticsearch Cluster æ¯å€‹ Node å¯ä»¥è—‰ç”± <code>Node Roles</code> è³¦äºˆé›†ç¾¤ä¸­çš„ç¯€é»ä¸åŒä»»å‹™ï¼Œå¸¸è¦‹çš„ç¸½é¡æœ‰:</p> <ul><li><font color="#63C5DA"><strong>Data Nodes</strong></font></li> <li><font color="#63C5DA"><strong>Master Nodes</strong></font></li> <li><font color="#63C5DA"><strong>Ingest Nodes</strong></font></li> <li><font color="#63C5DA"><strong>Machine Learning Nodes</strong></font></li> <li><font color="#63C5DA"><strong>Coordinator Nodes</strong></font></li></ul> <p>è©³ç´°æœƒåœ¨åˆ†å¸ƒå¼çš„ç­†è¨˜ä¸­è¨˜éŒ„</p> <h3 id="shard"><a href="#shard" class="header-anchor">#</a> Shard</h3> <p>Shard åˆæˆ–æ˜¯&quot;åˆ†ç‰‡&quot;ï¼Œåœ¨ Elasticsearch ä¸­ä¸€å€‹ Index æœƒè¢«åˆ‡åˆ†æˆå¤šå€‹ Shard ä¿å­˜åœ¨ä¸åŒçš„åœ°æ–¹ï¼Œ<br>
å¯ä»¥æƒ³åƒæˆä¸€å€‹è³‡æ–™åº«æ”¾ä¸ä¸‹äº†ï¼Œæ‰€ä»¥åˆ†åº«å„²å­˜ï¼Œ<br>
Shard çš„æ©Ÿåˆ¶å¹«åŠ© Elasticsearch å¯¦ç¾äº† <font color="#FF0000"><strong>è³‡æ–™çš„é«˜å¯ç”¨</strong></font> èˆ‡ <font color="#FF0000"><strong>å¯æ“´å±•æ€§</strong></font>ï¼Œ</p> <blockquote><p>There are two types of shards: primaries and replicas.</p></blockquote> <p>åœ¨ Elasticsearch ä¸­å­˜åœ¨è‘—å…©ç¨® Shardï¼Œå¦‚ä¸‹:</p> <ul><li><font color="#63C5DA"><strong>Primary Shard</strong></font></li></ul> <blockquote><p>Each document in an index belongs to one primary shard.</p></blockquote> <p>ç”¨ä¾†å„²å­˜è³‡æ–™ï¼Œå³å„²å­˜ document</p> <ul><li><font color="#63C5DA"><strong>Replica Shard</strong></font></li></ul> <blockquote><p>A replica shard is a copy of a primary shard.</p></blockquote> <p>ç”¨ä¾†ä½œç‚º Primary Shard è³‡æ–™çš„å‰¯æœ¬ï¼ŒåŒæ™‚æœ‰å…©å€‹ä¸»è¦åŠŸèƒ½ï¼Œä½œç‚ºé«˜å¯ç”¨çš„ç¡¬é«”å®¹éŒ¯ä¸¦ä¸”å¢åŠ æŸ¥è©¢æ™‚çš„æ•ˆèƒ½</p> <p>å‡è‹¥ä»Šå¤©åƒ…åƒ…åªæ˜¯ç°¡å–®çš„æ‡‰ç”¨ Elasticsearch Shard æ©Ÿåˆ¶å¯ä»¥é€™æ¨£ç†è§£ï¼Œ<br>
æ¯å€‹ Shard éƒ½æœ‰ä¸€å€‹è‡ªå·±çš„ Replica (æ¯å€‹åˆ†ç‰‡éƒ½æœ‰è‡ªå·±çš„å‰¯æœ¬)ï¼Œ<br>
åŒæ™‚ï¼› Shard èˆ‡è‡ªå·±æˆå°çš„ Replica ä¸æœƒåœ¨åŒä¸€å€‹ Node ä¸Šé¢ï¼Œ<br>
ä¸¦ä¸”ï¼›ç•¶é€™äº› Shard é›†åˆåœ¨ä¸€èµ·æ™‚å°±æ˜¯ä¸€å€‹å®Œæ•´çš„ Index</p> <p><img src="/BookELK/assets/img/IndexReplica.6f521f00.png" alt="esReplica"></p> <p>ä»¥ç‰©ç†å±¤é¢ä¾†èªªå°±æ˜¯è³‡æ–™é‡é æœŸæœƒå¾ˆå¤§ï¼Œæ‰€ä»¥åˆ‡é–‹ä¾†æ”¾åˆ°ä¸åŒçš„åœ°æ–¹ï¼Œ<br>
å¦‚æœä»¥å¯¦éš› Elasticsearch å¯¦è¸çš„æ¶æ§‹ä¾†èªªæ˜¯ï¼Œ<br>
æ¯å€‹ Shard éƒ½æ˜¯ Index çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ¯å€‹ Shard åˆæ˜¯ä¸€å€‹  <code>lucene index</code> ï¼Œ<br>
æ¯å€‹ <code>lucene index</code> åˆç®¡ç†ä¸€ç¾¤ <code>Segment</code>ï¼Œç”¨åœ–è§£å¯èƒ½æ¯”è¼ƒæ¸…æ¥š</p> <ul><li><p><font color="#63C5DA"><strong>é€™æ˜¯è³‡æ–™åˆ‡ç‰‡</strong></font></p> <p><img src="/BookELK/assets/img/esshardphysical.869a1c21.png" alt="esshardpysical"></p></li> <li><p><font color="#63C5DA"><strong>é€™æ˜¯å¯¦éš›æ¶æ§‹</strong></font></p> <p><img src="/BookELK/assets/img/esshardarchitecture.18b30ec1.png" alt="esshardarchitecture"></p></li></ul> <p>åœ¨ Elasticsearch ä¸­ï¼Œæ­£ç¢ºçš„ä½¿ç”¨ Shard å°‡æœƒå¸¶ä¾†çš„å¥½è™•</p> <ul><li><font color="#63C5DA"><strong>æ›´å¤§çš„å„²å­˜ç©ºé–“ï¼Œè³‡æ–™åˆ†æ•£åˆ°ä¸åŒçš„ Node</strong></font></li> <li><font color="#63C5DA"><strong>æ›´æœ‰æ•ˆç‡çš„æœå°‹æ•ˆèƒ½ï¼Œç•¶ä¸€å€‹ Query é€²ä¾†æ™‚ä¹Ÿåˆ†æ•£åˆ°ä¸åŒçš„ Node ä¸Š</strong></font></li></ul> <blockquote><p>The number of primary shards in an index is fixed at the time that an index is created,<br>
but the number of replica shards can be changed at any time,<br>
without interrupting indexing or query operations.</p></blockquote> <p>éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„é»ï¼›<br> <font color="#FF0000">åªæœ‰åœ¨ä¸€é–‹å§‹å»ºç«‹ Index æ™‚æ‰å¯ä»¥æŒ‡å®š Primary Shard çš„æ•¸é‡</font>ï¼Œ<br>
Replica Shards å‰‡æ˜¯åœ¨ä»»ä½•æ™‚å€™éƒ½å¯ä»¥è®Šæ›´ï¼Œ<br>
ä½†å¦‚æœéå¾—è¦è®Šæ›´ Primary Shard å°±éœ€è¦ ReIndex äº†ï¼Œ<br>
åœ¨ Elasticsearch å®˜æ–¹ç¶²ç«™ä¸­ï¼Œä¹Ÿæœ‰å¾ˆå¤šæ¢è¨é—œæ–¼ Shard ç­–ç•¥çš„æ–‡ç« ï¼Œéƒ½å¯ä»¥åƒè€ƒçœ‹çœ‹</p> <p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/size-your-shards.html" target="_blank" rel="noopener noreferrer">size-your-shards<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><p>ğŸ““ <font color="008000"><strong>Segment çŸ¥è­˜è£œå……</strong></font></p> <p>Elasticsearch æ˜¯ä¸€å€‹åŸºæ–¼ Lucene å¯¦ä½œçš„æ‡‰ç”¨ï¼Œ<br>
åœ¨ Lucene ä¸­æœ€å°çš„å„²å­˜å–®ä½å³æ˜¯ Segmentï¼Œä¸€å€‹ Segmentç•¶ä¸­åŒ…å«:</p> <ul><li>Inverted Index</li> <li>Sorted Fields</li> <li>Document Values</li> <li>Cache</li></ul></li></ul> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>ç†è§£ä¸€é–€æŠ€è¡“ï¼Œä¸€äº›åè©é‚„æ˜¯å¿…è¦ä¹‹æƒ¡ï¼Œ<br>
ä¸€é‚Šç†è§£åè©ä¸€é‚Šè£œåŸç† <s>(æ‰èƒ½å”¬äºº)</s>ï¼Œ<br>
æ¦‚å¿µæ€§çš„çŸ¥è­˜å¤ªå¤šé ­å¯¦åœ¨å¾ˆç—›ï¼Œ<br>
æœ‰æ¼æ‰çš„æ±è¥¿ä¹‹å¾ŒçœŸçš„æœ‰ä½¿ç”¨åˆ°æˆ–æƒ³åˆ°å†å›ä¾†è£œå§</p> <p><img src="/BookELK/assets/img/haoya.cb2188f5.jpg" alt="å¥½è€¶"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/BookELK/Elasticsearch/01_Introduction.html" class="prev">
        ELK Stack Intro
      </a></span> <span class="next"><a href="/BookELK/Elasticsearch/02_Index.html">
        Index
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/BookELK/assets/js/app.76926c1b.js" defer></script><script src="/BookELK/assets/js/2.6319aacc.js" defer></script><script src="/BookELK/assets/js/3.51cc2f96.js" defer></script>
  </body>
</html>
