<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Elasticsearch Document | 我的 Elastic Stack 筆記</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="已經到了不記下來就會忘記的年紀了，紀錄一下自身學習 Elasticsearch;Logstash;Kibana;Beats 的一些歷程">
    
    <link rel="preload" href="/BookELK/assets/css/0.styles.d96730b3.css" as="style"><link rel="preload" href="/BookELK/assets/js/app.fe2a90bb.js" as="script"><link rel="preload" href="/BookELK/assets/js/2.3c28ba36.js" as="script"><link rel="preload" href="/BookELK/assets/js/11.307bf1e3.js" as="script"><link rel="prefetch" href="/BookELK/assets/js/10.0bc62e52.js"><link rel="prefetch" href="/BookELK/assets/js/12.ac80a0f2.js"><link rel="prefetch" href="/BookELK/assets/js/13.5246d155.js"><link rel="prefetch" href="/BookELK/assets/js/14.27fd7d8f.js"><link rel="prefetch" href="/BookELK/assets/js/15.48dbbef5.js"><link rel="prefetch" href="/BookELK/assets/js/16.6cc53c07.js"><link rel="prefetch" href="/BookELK/assets/js/17.163ddb7b.js"><link rel="prefetch" href="/BookELK/assets/js/18.a58fd802.js"><link rel="prefetch" href="/BookELK/assets/js/19.52760e03.js"><link rel="prefetch" href="/BookELK/assets/js/20.1026c3a1.js"><link rel="prefetch" href="/BookELK/assets/js/21.42a9ef03.js"><link rel="prefetch" href="/BookELK/assets/js/22.7c81e515.js"><link rel="prefetch" href="/BookELK/assets/js/3.c7d33de4.js"><link rel="prefetch" href="/BookELK/assets/js/4.19ff4d86.js"><link rel="prefetch" href="/BookELK/assets/js/5.434e5743.js"><link rel="prefetch" href="/BookELK/assets/js/6.8ccfad5d.js"><link rel="prefetch" href="/BookELK/assets/js/7.7feef022.js"><link rel="prefetch" href="/BookELK/assets/js/8.192d7ddb.js"><link rel="prefetch" href="/BookELK/assets/js/9.59419722.js">
    <link rel="stylesheet" href="/BookELK/assets/css/0.styles.d96730b3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BookELK/" class="home-link router-link-active"><!----> <span class="site-name">我的 Elastic Stack 筆記</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Elastic stack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Elastic Stack Demo</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Elasticsearch</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BookELK/Elasticsearch01/01_Introduction.html" class="sidebar-link">基本</a></li><li><a href="/BookELK/Elasticsearch01/01_Template.html" class="sidebar-link">測試資料</a></li><li><a href="/BookELK/Elasticsearch01/02_Index.html" class="sidebar-link">Index</a></li><li><a href="/BookELK/Elasticsearch01/02_Document.html" aria-current="page" class="active sidebar-link">Document</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#簡單上手" class="sidebar-link">簡單上手</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#single-document-apis" class="sidebar-link">Single document APIs</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#index" class="sidebar-link">Index</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#get" class="sidebar-link">Get</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#delete" class="sidebar-link">Delete</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#update" class="sidebar-link">Update</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#multi-document-apis" class="sidebar-link">Multi-document APIs</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#multi-get" class="sidebar-link">Multi get</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#bulk" class="sidebar-link">Bulk</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#delete-by-query" class="sidebar-link">Delete by query</a></li><li class="sidebar-sub-header"><a href="/BookELK/Elasticsearch01/02_Document.html#update-by-query" class="sidebar-link">Update by query</a></li></ul></li><li><a href="/BookELK/Elasticsearch01/02_Mapping.html" class="sidebar-link">Mapping</a></li><li><a href="/BookELK/Elasticsearch01/02_Aliases.html" class="sidebar-link">Index Aliases</a></li><li><a href="/BookELK/Elasticsearch01/02_Analyzer.html" class="sidebar-link">Analyzer</a></li><li><a href="/BookELK/Elasticsearch01/02_AnalyzerCh.html" class="sidebar-link">Analyzer 中文分詞</a></li><li><a href="/BookELK/Elasticsearch01/02_SearchAPI.html" class="sidebar-link">Search API</a></li><li><a href="/BookELK/Elasticsearch01/02_Query.html" class="sidebar-link">Query DSL</a></li><li><a href="/BookELK/Elasticsearch01/02_Aggregations.html" class="sidebar-link">Aggregations</a></li><li><a href="/BookELK/Elasticsearch01/03_Cat.html" class="sidebar-link">cat</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>kibana</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Logstash</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Filebeat </span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="elasticsearch-document"><a href="#elasticsearch-document" class="header-anchor">#</a> Elasticsearch Document</h1> <p>  在 Elasticsearch 中以 Document 記錄每一筆資料，如同 MySQL 或 MSSQL 中的 Rows，我們往 RDBM 中 Table 加入一筆資料就是新增一個 Row；在 Elasticsearch 中加入一筆資料的話，則是往 Index 中加入一則 Document<br>
  Elasticsearch 為文件型資料庫(<a href="https://zh.wikipedia.org/zh-tw/NoSQL" target="_blank" rel="noopener noreferrer">見NoSQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)即使用文件儲存資料，這代表我們使用 Elasticsearch 來進行搜尋時搜尋結果的最小單位為 Document，Document 的基本格式為 JSON，在 Elasticsearch 中每個 Document 都一定會有一個獨有的ID</p> <p>📘 Reference</p> <ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs.html" target="_blank" rel="noopener noreferrer">Document APIs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/documents-indices.html" target="_blank" rel="noopener noreferrer">Data in: documents and indices<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="簡單上手"><a href="#簡單上手" class="header-anchor">#</a> 簡單上手</h2> <p>在關聯式資料庫中，我們習慣建表後插入數據，來試試如何在 Elasticsearch 中插入一筆資料</p> <ul><li><p>輸入第一筆資料</p> <div class="language-JSON extra-class"><pre class="language-json"><code>POST bookstore<span class="token number">-000001</span>/_doc/
<span class="token punctuation">{</span>
<span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;我的一天從4點30分開始：當你酣睡時，有人已醒來實現夢想！&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;author&quot;</span><span class="token operator">:</span><span class="token string">&quot;金有真&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/BookELK/assets/img/helloworld.4c39a25c.png" alt="第一筆資料"><br>
非常的簡單甚至不創建資料表或規定欄位就可以把數據落到磁盤中並持久化 (不過在真實的使用環境下，還是建議將需要搜尋的 Field 用 Mapping 建立相對應的 schema)</p> <p>建立成功會回傳</p> <ul><li><p>_index : 索引</p></li> <li><p>_type : 類似於關聯型資料庫的Table，在新版本中這個概念已經被棄用</p></li> <li><p>_id: 系統賦予的唯一Id，也可以自訂</p></li> <li><p>_version: 版號，資料變動時會更新</p></li> <li><p>result : 動作</p></li> <li><p>_shards : shards 相關訊息(留給之後的筆記)</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
<span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bookstore-000001&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;TxNw2IEBhEm5-aAiw0Zg&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;_version&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token property">&quot;result&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;created&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;_shards&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;total&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;successful&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;failed&quot;</span> <span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token property">&quot;_seq_no&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token property">&quot;_primary_term&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h2 id="single-document-apis"><a href="#single-document-apis" class="header-anchor">#</a> Single document APIs</h2> <p>單文件操作</p> <h2 id="index"><a href="#index" class="header-anchor">#</a> Index</h2> <p>藉由指定的 Index 添加 JSON document，如果指定的 document 已經存在，則會更新並把 _version 加一</p> <ul><li><p><code>PUT /&lt;target&gt;/_doc/&lt;_id&gt;</code></p></li> <li><p><code>POST /&lt;target&gt;/_doc/</code></p></li> <li><p>透過 Index 新增</p> <div class="language-JSON extra-class"><pre class="language-json"><code>POST bookstore<span class="token number">-000001</span>/_doc/
<span class="token punctuation">{</span>
<span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;我的一天從4點30分開始：當你酣睡時，有人已醒來實現夢想！&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;author&quot;</span><span class="token operator">:</span><span class="token string">&quot;金有真&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>透過 Index 新增，並自訂Id</p> <div class="language-JSON extra-class"><pre class="language-json"><code>POST bookstore<span class="token number">-000001</span>/_doc/<span class="token number">1</span>
<span class="token punctuation">{</span>
<span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;我的一天從4點30分開始：當你酣睡時，有人已醒來實現夢想！&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;author&quot;</span><span class="token operator">:</span><span class="token string">&quot;金有真&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="get"><a href="#get" class="header-anchor">#</a> Get</h2> <p>重索引中取得指定的  JSON document</p> <ul><li><p>取得文件</p> <div class="language-JSON extra-class"><pre class="language-json"><code>GET bookstore<span class="token number">-000001</span>/_doc/<span class="token number">1</span>
</code></pre></div><div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bookstore-000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_version&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_seq_no&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_primary_term&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;found&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;我的一天從4點30分開始：當你酣睡時，有人已醒來實現夢想！&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;金有真&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>檢查有無這筆文件資料</p> <div class="language-JSON extra-class"><pre class="language-json"><code>HEAD bookstore<span class="token number">-000001</span>/_doc/<span class="token number">1</span>
</code></pre></div><div class="language-JSON extra-class"><pre class="language-json"><code><span class="token number">200</span> - OK
</code></pre></div><p><img src="data:image/png;base64,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" alt="第一筆資料"></p></li></ul> <h2 id="delete"><a href="#delete" class="header-anchor">#</a> Delete</h2> <p>透過指定的 index 與 id 來刪除 document</p> <ul><li><p>刪除文件</p> <div class="language-JSON extra-class"><pre class="language-json"><code>DELETE bookstore<span class="token number">-000001</span>/_doc/<span class="token number">1</span>
</code></pre></div><div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bookstore-000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_version&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;deleted&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_shards&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;total&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;successful&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;failed&quot;</span> <span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_seq_no&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_primary_term&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><p>重新 head 一下，看有甚麼變化</p> <div class="language-JSON extra-class"><pre class="language-json"><code>HEAD bookstore<span class="token number">-000001</span>/_doc/<span class="token number">1</span>
</code></pre></div><div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;statusCode&quot;</span><span class="token operator">:</span><span class="token number">404</span><span class="token punctuation">,</span><span class="token property">&quot;error&quot;</span><span class="token operator">:</span><span class="token string">&quot;Not Found&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;message&quot;</span><span class="token operator">:</span><span class="token string">&quot;404 - Not Found&quot;</span><span class="token punctuation">}</span>
</code></pre></div><p>已經無此筆資料</p></li></ul> <h2 id="update"><a href="#update" class="header-anchor">#</a> Update</h2> <p>使用指定腳本 <code>script</code> 更新文件，在 Elasticsearch 中是沒有真正更新文件這個操作的，文件的更新都是先刪除之後再新建的原子操作(Elasticsearch 的強項是索引跟查詢，要頻繁修改請找專業的 ex MongoDB,MSSQL,MySQL)</p> <ul><li><p>更新文件</p> <p>先插入一筆資料</p> <div class="language-JSON extra-class"><pre class="language-json"><code>POST bookstore<span class="token number">-000001</span>/_doc/<span class="token number">1</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span><span class="token string">&quot;我的一天從4點30分開始：當你酣睡時，有人已醒來實現夢想！&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;author&quot;</span><span class="token operator">:</span><span class="token string">&quot;金有真&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>更新
用 ctx 指定 _source 下的 title 並賦予預更新的資料</p> <div class="language-JSON extra-class"><pre class="language-json"><code>POST bookstore<span class="token number">-000001</span>/_update/<span class="token number">1</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;script&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;ctx._source.title = '我的一天從4點30分開始...'&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>更新後可以看到 <code>_version</code> 從 版本1 變成 版本2 ( _version 為一種樂觀鎖的時候，詳細請見樂觀鎖 vs 悲觀鎖 )</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bookstore-000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_version&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;updated&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_shards&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;total&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;successful&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;failed&quot;</span> <span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_seq_no&quot;</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_primary_term&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="multi-document-apis"><a href="#multi-document-apis" class="header-anchor">#</a> Multi-document APIs</h2> <p>多文件同時操作</p> <h2 id="multi-get"><a href="#multi-get" class="header-anchor">#</a> Multi get</h2> <ul><li><p><code>GET /_mget</code></p></li> <li><p><code>GET /&lt;index&gt;/_mget</code></p></li> <li><p>透過 ID 檢視多個 JSON documents</p> <div class="language-JSON extra-class"><pre class="language-json"><code>GET /_mget
<span class="token punctuation">{</span>
  <span class="token property">&quot;docs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bookstore-000001&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bookstore-000001&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;docs&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bookstore-000001&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_version&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_seq_no&quot;</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_primary_term&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;found&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;我的一天從4點30分開始...&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;金有真&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bookstore-000001&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_version&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_seq_no&quot;</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_primary_term&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;found&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;這是我的，別想碰！：「所有權」潛規則如何控制我們的生活？&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;author&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;邁可．海勒, 詹姆斯．薩爾茲曼&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>等於</p> <div class="language-JSON extra-class"><pre class="language-json"><code>GET /bookstore<span class="token number">-000001</span>/_mget
<span class="token punctuation">{</span>
<span class="token property">&quot;docs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
     <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
     <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>等於</p> <div class="language-JSON extra-class"><pre class="language-json"><code>GET /bookstore<span class="token number">-000001</span>/_mget
<span class="token punctuation">{</span>
<span class="token property">&quot;ids&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="bulk"><a href="#bulk" class="header-anchor">#</a> Bulk</h2> <p>使用起來好用程度排名前幾名的API，可以在一次的 API call 中批次增刪改資料，可以連接減少開銷</p> <ul><li><p><code>POST /_bulk</code></p></li> <li><p><code>POST /&lt;target&gt;/_bulk</code></p></li> <li><p>Bulk</p> <div class="language-JSON extra-class"><pre class="language-json"><code>POST _bulk
  <span class="token punctuation">{</span> <span class="token property">&quot;index&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;field1&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;value1&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;delete&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;create&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;3&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;field1&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;value3&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;update&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">{</span> <span class="token property">&quot;doc&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;field2&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;value2&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="delete-by-query"><a href="#delete-by-query" class="header-anchor">#</a> Delete by query</h2> <p>透過指定的 query 來刪除文件</p> <h2 id="update-by-query"><a href="#update-by-query" class="header-anchor">#</a> Update by query</h2> <p>透過指定的 query 來更新文件</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/BookELK/Elasticsearch01/02_Index.html" class="prev">
        Index
      </a></span> <span class="next"><a href="/BookELK/Elasticsearch01/02_Mapping.html">
        Mapping
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/BookELK/assets/js/app.fe2a90bb.js" defer></script><script src="/BookELK/assets/js/2.3c28ba36.js" defer></script><script src="/BookELK/assets/js/11.307bf1e3.js" defer></script>
  </body>
</html>
