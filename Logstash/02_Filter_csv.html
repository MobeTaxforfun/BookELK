<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Logstash 匯出 CSV | 我的 Elastic Stack 筆記</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="已經到了不記下來就會忘記的年紀了，紀錄一下自身學習 Elasticsearch;Logstash;Kibana;Beats 的一些歷程">
    
    <link rel="preload" href="/BookELK/assets/css/0.styles.d96730b3.css" as="style"><link rel="preload" href="/BookELK/assets/js/app.eccb4e14.js" as="script"><link rel="preload" href="/BookELK/assets/js/2.6319aacc.js" as="script"><link rel="preload" href="/BookELK/assets/js/6.67ab2b88.js" as="script"><link rel="prefetch" href="/BookELK/assets/js/10.a870efe4.js"><link rel="prefetch" href="/BookELK/assets/js/11.1bf0ef2c.js"><link rel="prefetch" href="/BookELK/assets/js/12.26ef642a.js"><link rel="prefetch" href="/BookELK/assets/js/13.32f0189e.js"><link rel="prefetch" href="/BookELK/assets/js/14.e15f0edf.js"><link rel="prefetch" href="/BookELK/assets/js/15.75eba30d.js"><link rel="prefetch" href="/BookELK/assets/js/16.61622831.js"><link rel="prefetch" href="/BookELK/assets/js/17.36ad0752.js"><link rel="prefetch" href="/BookELK/assets/js/18.12297b0c.js"><link rel="prefetch" href="/BookELK/assets/js/19.ed2f083d.js"><link rel="prefetch" href="/BookELK/assets/js/20.3023fff0.js"><link rel="prefetch" href="/BookELK/assets/js/21.479d1e86.js"><link rel="prefetch" href="/BookELK/assets/js/22.a6b074b8.js"><link rel="prefetch" href="/BookELK/assets/js/23.85f62943.js"><link rel="prefetch" href="/BookELK/assets/js/24.b152d338.js"><link rel="prefetch" href="/BookELK/assets/js/25.3d08c2ca.js"><link rel="prefetch" href="/BookELK/assets/js/26.482be533.js"><link rel="prefetch" href="/BookELK/assets/js/27.f78275e0.js"><link rel="prefetch" href="/BookELK/assets/js/28.0c971abe.js"><link rel="prefetch" href="/BookELK/assets/js/29.07505f8d.js"><link rel="prefetch" href="/BookELK/assets/js/3.6d77eb43.js"><link rel="prefetch" href="/BookELK/assets/js/30.75b6a2e6.js"><link rel="prefetch" href="/BookELK/assets/js/31.d14f8f00.js"><link rel="prefetch" href="/BookELK/assets/js/32.4b2e25c5.js"><link rel="prefetch" href="/BookELK/assets/js/4.509066ce.js"><link rel="prefetch" href="/BookELK/assets/js/5.a7dd103d.js"><link rel="prefetch" href="/BookELK/assets/js/7.cde76e12.js"><link rel="prefetch" href="/BookELK/assets/js/8.9bb44987.js"><link rel="prefetch" href="/BookELK/assets/js/9.c48b5107.js">
    <link rel="stylesheet" href="/BookELK/assets/css/0.styles.d96730b3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BookELK/" class="home-link router-link-active"><!----> <span class="site-name">我的 Elastic Stack 筆記</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Elasticsearch</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>kibana</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Logstash</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BookELK/Logstash/02_Filter_csv.html" aria-current="page" class="active sidebar-link">Filter csv</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#事前準備工作" class="sidebar-link">事前準備工作</a></li><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#pipeline" class="sidebar-link">Pipeline</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#pm25csv-conf" class="sidebar-link">pm25csv.conf</a></li></ul></li><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#匯入資料" class="sidebar-link">匯入資料</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#實用指令" class="sidebar-link">實用指令</a></li><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#啟動-logstash-匯入資料" class="sidebar-link">啟動 Logstash 匯入資料</a></li><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#kibana-查看結果" class="sidebar-link">Kibana 查看結果</a></li></ul></li><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#mutate-filter-plugin" class="sidebar-link">Mutate filter plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#引入-mutate" class="sidebar-link">引入 mutate</a></li><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#最終成果" class="sidebar-link">最終成果</a></li></ul></li><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#補充" class="sidebar-link">補充</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#stdin" class="sidebar-link">Stdin</a></li><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#csv-新資料" class="sidebar-link">CSV 新資料</a></li><li class="sidebar-sub-header"><a href="/BookELK/Logstash/02_Filter_csv.html#重新載入" class="sidebar-link">重新載入</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Beats</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Demo</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Elastic stack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="logstash-匯出-csv"><a href="#logstash-匯出-csv" class="header-anchor">#</a> Logstash 匯出 CSV</h1> <p>Logstash 擅長將各式的資料倒入 Elasticsearch 中，此篇記錄一下使用 Logstash 將 CSV 中的資料匯入 elasticsearch 中的過程</p> <p>📘 Reference</p> <ul><li><a href="https://www.elastic.co/guide/en/logstash/current/index.html" target="_blank" rel="noopener noreferrer">官方文件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.kaggle.com/" target="_blank" rel="noopener noreferrer">kaggle 數據建模和數據分析平台<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-mutate.html#plugins-filters-mutate-convert" target="_blank" rel="noopener noreferrer">Mutate filter plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-csv.html" target="_blank" rel="noopener noreferrer">Csv filter plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="事前準備工作"><a href="#事前準備工作" class="header-anchor">#</a> 事前準備工作</h2> <ul><li>先下載 Logstash 本文使用版本 logstash-7.17.1-windows 版本</li> <li>找到一份 CSV 格式的資料，以<code>,</code>分隔資料，並有完整斷行</li> <li>解壓縮後內容如下:<br> <img src="/BookELK/assets/img/LogstashPipelinefolder.c7dd69a0.png" alt="logstash資料夾"></li> <li>在資料夾底下新增一個 <code>pipeline</code> 的資料夾之後用來存放 pipeline 設定檔</li> <li>以下為本文測試資料來至 Opendata pm2.5 csv 資料集結構如下:<br> <img src="/BookELK/assets/img/pm25test.f402b3ca.png" alt="測試資料"></li></ul> <h2 id="pipeline"><a href="#pipeline" class="header-anchor">#</a> Pipeline</h2> <p>準備好之後來編寫第一個 pipeline</p> <h3 id="pm25csv-conf"><a href="#pm25csv-conf" class="header-anchor">#</a> pm25csv.conf</h3> <p>在 <code>pipeline</code> 這個資料夾底下新增一個 pm25csv.conf 文件，文件內容如下:</p> <div class="language-JSON extra-class"><pre class="language-json"><code>input <span class="token punctuation">{</span>
    file <span class="token punctuation">{</span>
        path =&gt; <span class="token string">&quot;D:/DockerHub/Ref/Data/OpenData/pm25.csv&quot;</span>
        start_position =&gt; <span class="token string">&quot;beginning&quot;</span>
        sincedb_path=&gt;<span class="token string">&quot;D:/DockerHub/Ref/Data/OpenData/pm25.log&quot;</span>
    <span class="token punctuation">}</span>
    stdin <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
filter <span class="token punctuation">{</span>
    csv <span class="token punctuation">{</span>
        skip_header =&gt; <span class="token boolean">true</span>
        separator =&gt; <span class="token string">&quot;,&quot;</span>
        columns =&gt; <span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;device&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;town&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;types&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lat&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lon&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm25&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
output <span class="token punctuation">{</span>
    elasticsearch <span class="token punctuation">{</span> 
        hosts =&gt; <span class="token punctuation">[</span><span class="token string">&quot;http://localhost:9200/&quot;</span><span class="token punctuation">]</span>
        index =&gt; <span class="token string">&quot;pm25-v1&quot;</span>
    <span class="token punctuation">}</span>
    stdout <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>Logstash Pipline 的三大要素分別是 input; filter; output</p></li> <li><p><code>Input</code> : 我們指定兩個 資料來源一個是 file ; 另一個是 stdin</p> <ul><li><code>input stdin</code> 用來測試用的，下面會示範怎麼用</li> <li><code>input file path</code> 資料來源路徑</li> <li><code>input file start_position</code> 從甚麼位置開始讀取文件，Logstash預設是結束位置，就是每次都拿最後一筆，這種預設的模式適合用在讀 log 的環 境，因為若是 log 的話每次一筆新的日誌總是會添加在文件最後。而這邊我們導入的是整個 csv 文件所以讓 Logstash 從頭開始讀取設定為 <code>beginning</code> 當讀取到最末時，Logstash 將自動切換為預設模式 <code>End</code> 讀取最後一筆</li> <li><code>input file sincedb_path</code> 指定一個 log，這個 log 提供 Logstash <code>探針</code> 紀錄最後一筆讀取資料的偏移量，若不指定會自動產生，若不想紀錄請設為 <code>null</code>，為了方便管理大多時候建議還是紀錄一下</li></ul></li> <li><p><code>filter</code> : 這邊使用 <code>Csv filter plugin</code> 來做資料處理，文件請見置頂 Reference</p> <ul><li><code>filter csv skip_header</code> 指定跳過標頭</li> <li><code>filter csv separator</code> 設定為 <code>&quot;,&quot;</code> 以逗號標示資料間隔</li> <li><code>filter csv columns</code> 每個欄位資料如何解析進 Elasticsearch</li></ul></li> <li><p><code>output</code> : 主要輸出資料的目的地 Stdout and Elasticsearch，使用 <code>Elasticsearch output plugin</code>，還有許多不同的 plugin 可以輸出資料到其他的載體</p> <ul><li><code>output elasticsearch hosts</code> 預計輸出目標的 elasticsearch hosts</li> <li><code>output elasticsearch index</code> 預計輸出到哪個 index 下</li> <li><code>output stdout</code> 用來測試用的，下面會示範怎麼用</li></ul></li></ul> <p>⚠️ 這裡很重要 如果在 windows 環境下 <code>path =&gt; &quot;D:/DockerHub/Ref/Data/OpenData/pm25.csv&quot;</code> 路徑的正反斜線請注意<br>
   =&gt; 這是 windows 輸出的路徑 <code>D:\DockerHub\Ref\Data\OpenData\pm25.csv</code> (這是錯的)<br>
   =&gt; 這是 logstash 中約定的路徑 <code>D:/DockerHub/Ref/Data/OpenData/pm25.csv</code> (這是對的)<br>
   =&gt; 下面那個才可以成功運作</p> <h2 id="匯入資料"><a href="#匯入資料" class="header-anchor">#</a> 匯入資料</h2> <h3 id="實用指令"><a href="#實用指令" class="header-anchor">#</a> 實用指令</h3> <ul><li><p>相關的指令集都在 <code>bin</code> 裡面可以直接呼叫，檢視 Logstash 中的 plugin</p> <div class="language-sh extra-class"><pre class="language-sh"><code>.<span class="token punctuation">\</span>bin<span class="token punctuation">\</span>logstash-plugin list
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>  logstash-codec-avro
  logstash-codec-cef
  logstash-codec-collectd
  logstash-codec-dots
  logstash-codec-edn
  logstash-codec-edn_lines
  logstash-codec-es_bulk
  logstash-codec-fluent
  <span class="token punctuation">..</span>.下略
</code></pre></div><p><img src="/BookELK/assets/img/pluginlist.be1114c6.png" alt="logstashpluginlist"></p></li> <li><p>確定使用到 plugin 都已經在列表裡面，如下</p> <ul><li>logstash-input-stdin</li> <li>logstash-input-file</li> <li>logstash-filter-csv</li> <li>logstash-output-elasticsearch</li> <li>logstash-output-stdout
如果有缺，到官方去下載相對應版本的 plugin，但基本上應該都會有</li></ul></li></ul> <h3 id="啟動-logstash-匯入資料"><a href="#啟動-logstash-匯入資料" class="header-anchor">#</a> 啟動 Logstash 匯入資料</h3> <p>使用指令啟動 Logstash，-f 後面指定編寫好的 pipeline config (還有一個方法是用 pipeline.yml 中，使用方法預計也會有一篇筆記)</p> <div class="language-sh extra-class"><pre class="language-sh"><code>  .<span class="token punctuation">\</span>bin<span class="token punctuation">\</span>logstash -f .<span class="token punctuation">\</span>pipeline<span class="token punctuation">\</span>pm25csv.conf
</code></pre></div><p>若是啟動成功應該會看到資料一筆一筆的顯示在 terminal 上面，那是因為 pipeline <code>output stdout</code> 這個就是將輸出一併顯示在 terminal 上</p> <p><img src="/BookELK/assets/img/terminalresult.dec75601.png" alt="logstashpluginlist"></p> <h3 id="kibana-查看結果"><a href="#kibana-查看結果" class="header-anchor">#</a> Kibana 查看結果</h3> <p>使用 GET Index search 查看</p> <div class="language-JSON extra-class"><pre class="language-json"><code> GET pm25-v1/_search
</code></pre></div><p>可以看到 pm25-v1 這個 index 中已經有 1338 筆資料</p> <p><img src="/BookELK/assets/img/kibanaresult.8d49c7ae.png" alt="kibanaresult"></p> <h2 id="mutate-filter-plugin"><a href="#mutate-filter-plugin" class="header-anchor">#</a> Mutate filter plugin</h2> <p>雖然資料已經匯入成功了，但仔細觀察的話會發現有些問題，用 mapping 指定來查看 index mapping，會發現 &quot;temp&quot;,&quot;hum&quot;,&quot;pm25&quot; 這幾個欄位是 text ，在一般的應用我們更多時候希望這幾個欄位是以數值方式去對應，所以我們要修改一下 pipeline</p> <p><img src="/BookELK/assets/img/importcsvProblem.711c6968.png" alt="kibanaresult"></p> <p>對應的方法其實還有一種是一開始就先設定好 index 與 index mapping，這樣使用 Logstash 時只要將資料導入即可，不過這邊嘗試一下不用事先去建立 mapping 的方法，我們使用 mutate plugin 來處理，詳細文件見置頂( mutate 操作彈性滿大的)</p> <p>mutate plugin 提供了幾種資料型態對應 integer;integer_eu;float;float_eu;string;boolean，只要在 <code>filter</code> 中引入 <code>mutate plugin</code></p> <h3 id="引入-mutate"><a href="#引入-mutate" class="header-anchor">#</a> 引入 mutate</h3> <p><code>filter mutate convert</code> 欄位 =&gt; 指定型別，就可以將數值轉型，最後設定檔如下</p> <div class="language-JSON extra-class"><pre class="language-json"><code>    input <span class="token punctuation">{</span>
        file <span class="token punctuation">{</span>
            path =&gt; <span class="token string">&quot;D:/DockerHub/Ref/Data/OpenData/pm25.csv&quot;</span>
            start_position =&gt; <span class="token string">&quot;beginning&quot;</span>
            sincedb_path=&gt;<span class="token string">&quot;D:/DockerHub/Ref/Data/OpenData/pm25.log&quot;</span>
        <span class="token punctuation">}</span>
        stdin <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    filter <span class="token punctuation">{</span>
        csv <span class="token punctuation">{</span>
            skip_header =&gt; <span class="token boolean">true</span>
            separator =&gt; <span class="token string">&quot;,&quot;</span>
            columns =&gt; <span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;device&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;town&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;types&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lat&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lon&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hum&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm25&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        mutate <span class="token punctuation">{</span>
            convert =&gt; <span class="token punctuation">{</span>
                <span class="token string">&quot;temp&quot;</span> =&gt; <span class="token string">&quot;float&quot;</span>
                <span class="token string">&quot;hum&quot;</span> =&gt; <span class="token string">&quot;float&quot;</span>
                <span class="token string">&quot;pm25&quot;</span> =&gt; <span class="token string">&quot;float&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    output <span class="token punctuation">{</span>
        elasticsearch <span class="token punctuation">{</span> 
            hosts =&gt; <span class="token punctuation">[</span><span class="token string">&quot;http://localhost:9200/&quot;</span><span class="token punctuation">]</span>
            index =&gt; <span class="token string">&quot;pm25-v1&quot;</span>
        <span class="token punctuation">}</span>
        stdout <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="最終成果"><a href="#最終成果" class="header-anchor">#</a> 最終成果</h3> <p>一樣把 mapping 提取出來檢視</p> <div class="language-JSON extra-class"><pre class="language-json"><code>GET pm25-v1/_mapping/field/hum<span class="token punctuation">,</span>temp<span class="token punctuation">,</span>pm25
</code></pre></div><p>可以看到 hum,temp,pm25 這三個 field 都已經是 <code>&quot;type&quot; : &quot;float&quot;</code></p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;pm25-v1&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;mappings&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;hum&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;full_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;hum&quot;</span><span class="token punctuation">,</span>
              <span class="token property">&quot;mapping&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token property">&quot;hum&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;float&quot;</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;temp&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;full_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;temp&quot;</span><span class="token punctuation">,</span>
              <span class="token property">&quot;mapping&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token property">&quot;temp&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;float&quot;</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;pm25&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;full_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;pm25&quot;</span><span class="token punctuation">,</span>
              <span class="token property">&quot;mapping&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token property">&quot;pm25&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;float&quot;</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="補充"><a href="#補充" class="header-anchor">#</a> 補充</h2> <h3 id="stdin"><a href="#stdin" class="header-anchor">#</a> Stdin</h3> <p>基本上這個也可以不用加，不過加了可以用來偵錯，這個可以讓 terminal 接收輸入，例如輸入 Hello world，就會插入一筆 Hello world 資料到指定的 index 中
<img src="/BookELK/assets/img/hellowolrd.aed53ab2.png" alt="kibanaresult"></p> <h3 id="csv-新資料"><a href="#csv-新資料" class="header-anchor">#</a> CSV 新資料</h3> <p>如果往 CSV 裡面新增資料的話，探針會繼續移動並將資料自動推送到 elasticsearch 中，增加一筆測試
<img src="/BookELK/assets/img/csvnewrow.82cbdeb0.png" alt="kibanaresult"></p> <h3 id="重新載入"><a href="#重新載入" class="header-anchor">#</a> 重新載入</h3> <p>若要重新載入要將指針歸零，或是把 .log 直接刪除</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/BookELK/Elasticsearch/03_Cat.html" class="prev">
        Cat
      </a></span> <span class="next"><a href="/BookELK/Beats/BeatsIntro.html">
        Beats Introduction
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/BookELK/assets/js/app.eccb4e14.js" defer></script><script src="/BookELK/assets/js/2.6319aacc.js" defer></script><script src="/BookELK/assets/js/6.67ab2b88.js" defer></script>
  </body>
</html>
